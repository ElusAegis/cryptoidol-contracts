// SPDX-License-Identifier: UNLICENSED
pragma solidity ^0.8.13;

import {Test, console2} from "forge-std/Test.sol";
import {CryptoIdol} from "../src/CryptoIdol.sol";
import {Halo2Verifier} from "../src/Halo2Verifier.sol";
import {LibString} from "lib/solady/src/utils/LibString.sol";

contract CryptoIdolHarness is CryptoIdol {
    constructor (address owner_, address verifier_)
        CryptoIdol(owner_, verifier_)
    {
        maxTokenCount = 1_000;

    }
    function unrestrictedMint() external {
        ++tokenCount;

        if (tokenCount > maxTokenCount) {
            revert CryptoIdol.MINTED_OUT();
        }

        score[tokenCount] = 0;
        minter[tokenCount] = msg.sender;
        mintTime[tokenCount] = block.timestamp;
        _safeMint(msg.sender, tokenCount);
    }
}

abstract contract ERC721TokenReceiver {
    function onERC721Received(address, address, uint256, bytes calldata)
        external
        virtual
        returns (bytes4)
    {
        return ERC721TokenReceiver.onERC721Received.selector;
    }
}


contract CryptoIdolTest is Test, ERC721TokenReceiver {
    using LibString for uint256;

    CryptoIdolHarness public ci;
    Halo2Verifier public civ;

    function setUp() public {
        civ = new Halo2Verifier();
        ci = new CryptoIdolHarness(address(this), address(civ));
    }

    receive() payable external {

    }

    function testSymbolAndName() public {
        assertEq(ci.name(), "CryptoIdol");
        assertEq(ci.symbol(), "IDOLNFT");
    }

    function testIfOwnerCanUpdateVerifier() public {
        Halo2Verifier newCiv = new Halo2Verifier();

        ci.updateVerifier(address(newCiv));

        assertEq(address(ci.verifier()), address(newCiv));

        ci.updateVerifier(address(civ));

        assertEq(address(ci.verifier()), address(civ));
    }

    function testFailIfNonOwnerCanUpdateVerifier() public {
        Halo2Verifier newCiv = new Halo2Verifier();
        vm.prank(address(1));
        ci.updateVerifier(address(newCiv));
    }

    function testMint() public {
        string[] memory input_proof = new string[](3);
        input_proof[0] = "echo";
        input_proof[1] = "-n";
        input_proof[2] = "0x000355d345e99f516a419d605c0037ce26284fc37dc73a7bdd08806267faca6113aa5a8f998df4c32ab041d61a27f1fcec4eddf33ff3c7272f8457a8ef5a0577234dd46c27651c5f6e30acc20183557429f13608565c9a8d14b0441f53a493d7295a6404eb18ffd6a92865138e832520cf592fe412f7684c3a36cef7185e34c102dac92cefa72eb5b812821d58f6e149a40b94e517364c532e715baea96264fa2c36057d8c92b7e7735a88f0f82190103a60cc55e3215b27c4669ca3842f55c30a07d8b5e2fc9d5f28c49dbc2e1c19cc5a0377a4389ce1ca8462ff55a7bfcf5d064e82f85b6354be39bde9c56ce951a75131c2643b5cfca1d33b47389aa935c720f1d10410dc7fe7fbc3b5f189207b7f0d6bdac7b6a03855314306ee85e014272ca6716e680f9973f6e2b7cba751b4a302db05decbe0168e351de72a9a199a61092b15c0d3159aa3cbb1336fe0cb0729df5473eca37b2148b4d825db7816bcab016d0dbce8543acdd8b3b9f4534487ab0da1fb2c43bf32028c345b42613079042cc23c66d2a7957c92b47c0447efeec51184ed33e066a8a39c0747a4513b8eaa061038755ae304246205dda071110a19490d026ecdfdd784da5d09b68921e2db11a85c7e2ac01424cb8a0dec005e3c06dbe5b181baba91939a96aadb704f9a7d13417c816325d52e19383055bdc765d744bdd929c44a48c2d6235f3033361c1f2eec33a25a084cff6f048f83b84e4743d41c93e7b36b06be4533775d2b5a03cd090440aef95913e9d9dafc68082b692bdbc1d58f16d17a4b8c11696fc45e7593093756c3e77f1782e9a591cc681e3968b9d5e40d0962d4b725baab7f53c5d7631346dcf5f620437a5c0c2798b43b28d40f5dd40bef8e3f24c502d3837058461d062a40852126acd8f81da3610150c01519e0c9a045f695cd6ddcbe683342a8df0df45d855befa336e9d5df3dd7281f6568128fd426ac6c0eea033d1383478cbe0e59d490b555d8b2d8b1397af3eefa51cc055470c824800cd8eff20e99b2336b1abb69a7e062059379bacaede4ca11a5936fc4fdb161fd6aece114933299d1b00a99f205d382201be73fb7718bd96ee9a0417ff2c94626aef85ed7b04aec04592cc175bcd4c37f95073cdf6f953dac18d47e74feedf6fba8f64ce2b0a142d7d222048a73297e669427ff6a0ccb02824c03e8dad6afa5001dfcbba685e465c67825b7dd40a144c5c813651bba54a1931fe036a67c1a98541df9126112362ec6171aa5cdc7d576849104b93f0f6d773ee7d5311a4642ff2aedca2c4182432b7fe22c46d1c948abcd76359ede358b2f7f46efdacbed49e0130208959403e8f72f9e0dd3a97a10d256e816e175af2b208413d03bf674e4c65fd14404b1b54863c1450b4418d088746aad957a2a5da6a0b6cd25c39ab88d507826079cf163732c1d4c05a3bb844e36bbf9d2c6def18330ebec250203ea8f93fb3084446b855b988e440f6930b6e74a33a9268e857536fffb5413ea33e1d965a4e7f3c19ebe60b747a623bb2d7d9f59c1bc728347ba4c688eeff48e617c1b413ca44c499dd8f94bfd601e56280be8a1a284bbcadcb796e7911da89e7daa9f8c11b923a53f55cfb8761a04e1df908501d04e63e6b600b1ec69e4ae2e3f51217995fb94bbdc5937f79d0c2c566134597aabf03e322061864a9d2023f7e177564944854fa0aa7eef94ca742e66d0a694733d2c1cd17ec2300ae488ab7b53280fc17d77f765acd3ebc6bbdf1c8554a361994b44622bb019ac884d366a4de7013b4b3c51e732fe4746480ea42b80cf2954a67ab846526d340c0ea7e1b4ee5d0a07b05db2f933683d4ace8f401c3c10294da272820096730a58fc1085e84319b83ed142670d1a166beb5e96571979b74228593bc3a2b91152f1f242660c6d8bc556389d51e2556f88a46264ad2b724aa5c7342399d00c6ff004edca25783768144c553f262501ffa0569d778209e0b39db6c14d73617eaee4a693833983a4bbff9b04e8940e879d2b3f0d8ae209e504b2e8f1fbcc002cb2dc91a631d682443c75a2a30a04f4bf8b1f2203c883083ff7ad35eb261bae9986f277e10b75909eecfbb35a2eb47b4409500af0df3d096f27701c4803fb90b379619d187b28d8cf56015949480d839317ff10516752109e45b28667011f310c2b0c1fa9dc5dc4270dc4806e369b58510d8aef099f351d61ccc5debdc53435d8b3d10cf8d2ce7770ae87e47c5444d51c7b3ae7a1d3ad1852457025c13c799ad6c171628d48ef8edf3836777792ecc630877720989ade1a3b29d43890bee13843391f984e1cac704e2817d4cfe2d7ccab12827b657bfa048677625adfec958c6f3c3071b370909c662bd659adac9654b1ccb6e95bfeda1d2f128e4f32b5e657acdab42ec5fabd8fde3cdaa82ad88035c0cdeb7003ada528a5444d762711084ceaeb06f74b1ed0b400d4a263e007ec5a1a454258f72ef227a5db6bb67890c1e4ebbdaf8760c665201f433a42d1c863d65034fff04a73841294e5ed0fb61b823328fa9bdeccc74425648344752441d90ed465c278d537bc22071aeee18a55d83c88c4fb8c1f36cf26e1e0cd3e778b5abf3aa121813deb000e9c5c6aa6888f4040d24e702888cf803df95abba98737cdcbd041bdedcbf61f0c44a8058352eb65c79906d2ff97481da0b383088894c01405305592fa51fb1405a9378712c6733977ae93425a8b060272a51767c621e04643bc08e6f31c70b706991a1d1016ea19a24395871fe6f2bdc2c711ca83bc6cac474d670b54997d120e2ce9ab5e1ce66f2b17fd8d304672aafa5c50088d6b5802512edd19d20c736f2cf74eeac1ab3e0a9536ac57336664be23d08a8e23227efa529008de1d765b422506cab1bb6dd041e840234621403f282b8577b6b0c616f731927483172a4edb1d24ddf825bb58fc2b9ec704e46f72d9f04c674fc34e0d3705d1fc4e869065552bbf81c2bb30c3b18bb258bdd9864bdeb0f846107470d6f3aff5dc8493fed995226bd64be75b365eeb1f58dc941ef17452ab43878f07cfca54fb6dc42bbf52a1266ff5bf6d6d04ea7eea1f1a58896e0b731b36c8085a8dd8a84907fbb5bdfac609c04d579390b40a48a6436a9f90aa5fe82d40e13dd417880f7b46264b98041f07e243775318e0a91c52ca280cb0521f65b7694b8984a53cf0e1cd77eb58373a2add755f2a73b78926fe46a1530cbd213be96245133ea94318c8ce8f38e3c7e82fb9824602d80fa20dd3f1fff43a5cbedc8bba022cca9a3cf5e97cb1e80de54d18d57152f5b8431e91b2659bba76496a299ec126fade57e08f600d571d456ee71daaf2539f3696e912a909a7e0082f77339cabc49e3fcf11253c2ba3c4df70e1114a5112c491a136d17c80381566491d32d22991916609e421a2dbdddd43442d22eb78788efb1ea777628ec29466627c015022f27376a7dd2983501b5edbae790367b8bd34caf7f540e4eae56dd5c6e448a59c423ff0d962b5780a288a6730871c76729066f09a70bfa69426b5ba57aa64411fc82c312b53e69969a09c10a9a119c7ae61938f3c8aaf1c86d894e9d057e73c89791a3aa1796d8e83b0ceb66dfd25ab5fda93df1c33f0bbb8ab971fb13e3c28e1ad9fe26c695517f911904610a729877ec10a1610fdc9f15da09a004546b666f9f77dd1fea64e48dcfef65dd6602c3ebb761048a84659e8869a99c8dc5a8615854a55ce55d4b1243dade019e3ef067e7b07eed2414443926ce9d219d380f83731defd1ad2e282462531badb8df705544e22a7e1ce5b1359254001d40dec0cf00d635e3ffff6aee0c9d706721b6d0ae1e33662b607e692e68ea4c08fb93632c445dee54960cb11a5d26f9102a96a1532aa9cd27f44494237c5dee0c51f1f7a4cda49da0cb856e68089f9c424baf10e0e1037a01ed7c5836a090f63b1001b3f8004ceb38fade675068e8caeeb021823433090dcd771514da66ac9b5b3815cbf6e1eed15ca2bc76d234401a6259a232bfe132200e1fbc9e7dcf227695172ef8a1c5b5442ec2e0456a09c9972b50be91fafcf6f796b80fc9b39e83763f7abe4cc820ea774de13036a250a79070d972f2e7ade04785bba6e88ca3414c54c1349e71bf9c9f94bde948f69e64ad92796ff00d80c2d8b83d2f8f221d2e58a254a1946b0cca25a5c173f4e02eccf89c698621b394fbbf698b42aa8aac8405ac0620c55a0776c232c31c9915e646204e9922c0ae36860ca94110c8cd920ad7f0a96440496491f38e8b9c4780859406dcf1d1b00000000000000000000000000000000000000000000000000000000000000000f7019c1f4ad609f52e1f94e67441ff61e573dd2bc8b66849a8e36a7c71e2f82097def10025fffedc6bc59358e59eee042d409421e42e8752f1a1ee9871d9f09050f2ac8b09a442da82db485ce1e096d9ba28f08b2d43557e07139491d3346e316c7417424296ca07a620a559d8cd1d66dbb9aeef08d0d140e8776081190d44e14269e4ef01131cf182a6cd0e8e0f03fb1d6b3124e0c04f33984c94a2e54060c08559ebf1e57832e653ac16d44c173d2f9a5101ec4e6db8f435782854dda8e152405b86e1cd06c37c80997bf1448fe8b609a682a0d2dd320fe5e247d400710621acabd45c62c66f7d3cff9c6d003472d8449c2341cd22501db2190ea63c1c91f1df3aced4f93fff21c9975c3bc0c83d479d5b2f8038e5ac98c3c1b67fbebaa782c6a5305453e345ca396e2776d2c891e4ad74bb9f2164f0c12adad528b38b17623922c7061c76342c312a2ad5f8885edaaa8edce4bff3a026df9e821c2d9e29927d6332e0102e9d303ec0ff7e598a8e0adbe4909bb81e6228f82767706859e0411bf54ebe10a0b7f38ab2709e91dd92252ce0df292a5c339073d7bf93eaf552e0c794f136ac86d4b4e6bd6105fb6b2be544ed7c95926d32c11082ace46646ab20871629063e7150af040237aaafe792d5543823adf2a065b5c4e0520760ef053000000000000000000000000000000000000000000000000000000000000000012140a304f9ab2af34625256cf496aa8a43cf6bb886dd686aebe27dfa659c4dd14589f2ff7ddd1e3be2f7184b7e5e4c9a35394227cc013f6df62b287d15e3d7d2bbfce10bdb448101c5820c9075b4e0ca4a57c5178288cd4578a371a0085132c1687975eb5a0fc2c28cb1bb24fd6bc32217a9dc1050bee4b281ce646a04fa47805c2fdffb065d2f2947d255ef202e6641c4a9465b00006b7186a77261d3bcf500a33e3e0ac5eb690eb43c7bb77f87f07019a87af59bfc354e7de5afbb326405a00000000000000000000000000000000000000000000000000000000000000001b561c622a022160541aa7aceef7592c3678f80cda2738f5da474c3276bfd78b2c83cf6a1566c1070baaef1eeae9b55ca0c1cd46c6f72d0986d1f5c87b4b7e2617536f4ab08e42ad1a67cbb1bd408259a96cdc73133293af84d86750a749c40b014528c70d05508a5b3b58b41a09381be7174d4a84de8c22f7aacd4ba3f947fe1b5ddc0d0b745465a106348293e814d5d59c776269af8f4ab064cb2310c2389f1785665013cd3eeb1440dabdbe06d0502e26f8fdf859caf3850f29abe67a3aff26b7339a4d606686e0f9a5d2c1d5e566b0311a99f99495701ee4512c995b17490a9fcc7fef5f749ab7af223f516b29917eb1667391acfc78ac3ce4e80fc878641517d3d60ca6df555874f1c580aa81984e076009559c5a35a3ede1f2022afaa104aaee4ff87ac62835300c8388f46197aa6339049e49e65c350b3b198d9cfcab0d78afe15e280b34132074a797158853786d464eea0f2d181fcc547b9d69ae9718ad7d0f48a00a0223550a0265392d2097f106846646e032a85516514bfdbc962e38373dbd25c304cbb000ebb7d2bd589e750b831106a31a6750221391c1f36c2ca9a43eeb9b047a22592302274832e64d003c5d9329515d0179ec4ab38649bb054a5d44f3f23be72b5efce5d09cf962254a284dd29b932da2c7aa053fd1fb3902c2b8ebd8974d6f77b0d99b8b92a6a39dad69a30af83647edd5f14e3e625530210e2311f5736d14c43b58dd10ecb479e882ce1b34aded8dfe3e3935123bbce50011d958fceed03f420535c49e35720772abf1a8c711737bd86171c1abe8eb7f05206e579e520dd765c0c65112150c17a71781fd152022a929ba1ca245864ab21fbd1b5e8f6bca8551dc4c26770bb4634e2b273a4dff9b33fa8d2dfe588701e30495afcb0cde8d0167234604313563501a8f8e92799bce543cc0ca91572e7fc202d59ee886cd5064953ae17c15213db623219bcbbcb7de0be9d62efea39c3b2207a726145609d4931e5c58aaf28f49e79d8c8e3ae5a904dd17fb8c1ed62d357920c33c2039c79c184b8e4b8e37aefbaf8a5004d2ee787505e91f0f4b5956175e1a0558d998d768300d4d72aa6d51c01dee8879c6720fa015b41104b9bbbee9131a73ee76765e1755224cac6bdc11084d6254e3b718b2677e56332a6d7d200ca6158b12696532eb35e7d0fb35598a9b44bee43f4fa956e95c32128d43175109f51eb459f12fefd51f08a817ba6b9dcaa8b236417e305c707343aa8255eed4c6262ecf830ed08579d5f6057daa8a0c31ccd061dbf1d8069ec347c941870d449b060c2e6043113299905eedabf268bd288ac12498da70e23fe299cfbb87319e976528c5892b5aaf1f7cd17b6a9c4fdb1a252d3dafbdaa7c0cf136e9207c71611b440808dd45029a917aff55f5387f105a1d68fa33a450d182e21c0223525e43fa1f19c4d8b5128cdeb3aa8608153955d59e59ceb7edd3934c2fc9821b21647ec80217237f568ab3e58920fef8d807fd950165f1f0b889140652972ba3188db7b1b20e30dd6bfd3784a846af26789e66d7b092dfd2b550681d23fad3cad07f6c39990c4dec3173e0c62a239f302bc7de7866d12aadbbb1ca2f31e5b08d9b3cbc5cc20f57d484d518a7bf1991b477c5e4eb2fea3e38a446c1d39c90a01411cbfe49872edd9207bb720c4189917f1a5c9c3c09b45d33716a80982b4e1b286fac2ba1cc0ecfefdba185c0a5f4ad954872b44d459fba0271109ca64e44adb6085763262801fb368b65617daf8c12c25c8bbcc9d64204e672c7b86f8ee4816484d97cbd341d6e63d4e57b886d7e13388a54d9fbcb4783d8f981fbc4f4de6fac6caf15da57112b60520baa9b519255c7dd3222f4022d38d5578b419e3d527c2913190fdad12304f4a6c0ee03028409820744ef2c209f5f64f839111be0f520a58164a03f1e1dd602725213fc34688f4aeba24e4d7049c1cc00d0a854343b3228aa44fc60a72ceab6764ff445f59d541d1c663ad11d1783c4fe5b3871afdae56e5ff8e25f021f3e1eac9a0eb8f1959c7af3c13a53ccca7445c50bf70c07e4d24487a0d1113b1ea524a775901cb670ad57e9690d4cc0c1a76f7483957330879f671087731cee14a282bb8bbc106adcbd3b1b644e7ef941fc723d3cc9764599da48a33c1c800f1b6b4d0f90e624da9feb735d0f28e1f0a42dd56c7976fccc3b4d6fcd600fe2080a751da3254bc6cd4f1ee28a5400fd53a99eb47f3601fd8f30e61eda3a6541da2ed8f9a8a4f4212673b6a4d2b4ec6c6be1f591e1010cf28cfb169b832d055e1c040fe89536c0adbc159c806f808cd5579a0ee941e0aa05f87645571b2105c73c0465353631568dcc420390f3d38b379cf2da03a9fb831f0dce624af4c4b69c5810526b473a34e7d568481ac2ec149326cc86f52af9f1c3a4254bd71b816c722b0bc501544009539608745c303f7fda9017b0f429197c6e5783f3b1c657c1780d07807c0de5d71e1c5a84e85c23f1970aa65b64e67d072bb46fe434ed69c506b12cc46bfc8741e6d0f06579ee32cb1ca4d85e54f8a2536de47f25573f9003c30f2d5442331b41bf0f465b8ac39b2b7b6ae6e5e0e5b2a036155b79e532a1b3be1a198c9c869c434d8e9ab1d22ee4694083ec1dd95ebb72eb7cfd7d6a59a0562d8f130a53837a1eec683fe7c341f2330f38155026a5b0f497b60b9d65218e075d9823b35192370e83c9f058c229f888d6c85fbb84e34612a0a2191f25fa0c83c2b7";

        bytes memory proof = vm.ffi(input_proof);

        string[] memory input_instance_0 = new string[](3);
        input_instance_0[0] = "echo";
        input_instance_0[1] = "-n";
        input_instance_0[2] = "0x0000000000000000000000000000000000000000000000000000000000000000";

        bytes memory res_instance_0 = vm.ffi(input_instance_0);
        uint256 instance_0 = abi.decode(res_instance_0, (uint256));


        uint256[] memory instances = new uint256[](1);
        instances[0] = instance_0;

        bytes32 resultHash = keccak256(abi.encode(proof, instances));

        // commit result
        ci.commitResult(resultHash);
        (address committer, uint64 commitTime, uint64 revealTime) = ci.commits(resultHash);

        assertEq(committer, address(this));
        assertEq(commitTime, block.timestamp);
        assertEq(revealTime, 0);


        // mint and balance check
        uint256 myBalance = address(this).balance;
        ci.mint{value: 0.01 ether}(proof, instances);
        assertTrue(address(this).balance <= myBalance - 0.01 ether);
        assertEq(address(ci).balance, 0.01 ether);
        assertEq(ci.balanceOf(address(this)), 1);
        ci.withdraw();
        assertEq(address(ci).balance, 0);
        assertTrue(address(this).balance >= myBalance);

        // output metadata into file
        string memory metadata_output = ci.tokenURI(1);
        vm.writeJson(metadata_output, "./test/metadata/1");
    }

    function testFailMintNoncommitter() public {
        string[] memory input_proof = new string[](3);
        input_proof[0] = "echo";
        input_proof[1] = "-n";
        input_proof[2] = "0x000355d345e99f516a419d605c0037ce26284fc37dc73a7bdd08806267faca6113aa5a8f998df4c32ab041d61a27f1fcec4eddf33ff3c7272f8457a8ef5a0577234dd46c27651c5f6e30acc20183557429f13608565c9a8d14b0441f53a493d7295a6404eb18ffd6a92865138e832520cf592fe412f7684c3a36cef7185e34c102dac92cefa72eb5b812821d58f6e149a40b94e517364c532e715baea96264fa2c36057d8c92b7e7735a88f0f82190103a60cc55e3215b27c4669ca3842f55c30a07d8b5e2fc9d5f28c49dbc2e1c19cc5a0377a4389ce1ca8462ff55a7bfcf5d064e82f85b6354be39bde9c56ce951a75131c2643b5cfca1d33b47389aa935c720f1d10410dc7fe7fbc3b5f189207b7f0d6bdac7b6a03855314306ee85e014272ca6716e680f9973f6e2b7cba751b4a302db05decbe0168e351de72a9a199a61092b15c0d3159aa3cbb1336fe0cb0729df5473eca37b2148b4d825db7816bcab016d0dbce8543acdd8b3b9f4534487ab0da1fb2c43bf32028c345b42613079042cc23c66d2a7957c92b47c0447efeec51184ed33e066a8a39c0747a4513b8eaa061038755ae304246205dda071110a19490d026ecdfdd784da5d09b68921e2db11a85c7e2ac01424cb8a0dec005e3c06dbe5b181baba91939a96aadb704f9a7d13417c816325d52e19383055bdc765d744bdd929c44a48c2d6235f3033361c1f2eec33a25a084cff6f048f83b84e4743d41c93e7b36b06be4533775d2b5a03cd090440aef95913e9d9dafc68082b692bdbc1d58f16d17a4b8c11696fc45e7593093756c3e77f1782e9a591cc681e3968b9d5e40d0962d4b725baab7f53c5d7631346dcf5f620437a5c0c2798b43b28d40f5dd40bef8e3f24c502d3837058461d062a40852126acd8f81da3610150c01519e0c9a045f695cd6ddcbe683342a8df0df45d855befa336e9d5df3dd7281f6568128fd426ac6c0eea033d1383478cbe0e59d490b555d8b2d8b1397af3eefa51cc055470c824800cd8eff20e99b2336b1abb69a7e062059379bacaede4ca11a5936fc4fdb161fd6aece114933299d1b00a99f205d382201be73fb7718bd96ee9a0417ff2c94626aef85ed7b04aec04592cc175bcd4c37f95073cdf6f953dac18d47e74feedf6fba8f64ce2b0a142d7d222048a73297e669427ff6a0ccb02824c03e8dad6afa5001dfcbba685e465c67825b7dd40a144c5c813651bba54a1931fe036a67c1a98541df9126112362ec6171aa5cdc7d576849104b93f0f6d773ee7d5311a4642ff2aedca2c4182432b7fe22c46d1c948abcd76359ede358b2f7f46efdacbed49e0130208959403e8f72f9e0dd3a97a10d256e816e175af2b208413d03bf674e4c65fd14404b1b54863c1450b4418d088746aad957a2a5da6a0b6cd25c39ab88d507826079cf163732c1d4c05a3bb844e36bbf9d2c6def18330ebec250203ea8f93fb3084446b855b988e440f6930b6e74a33a9268e857536fffb5413ea33e1d965a4e7f3c19ebe60b747a623bb2d7d9f59c1bc728347ba4c688eeff48e617c1b413ca44c499dd8f94bfd601e56280be8a1a284bbcadcb796e7911da89e7daa9f8c11b923a53f55cfb8761a04e1df908501d04e63e6b600b1ec69e4ae2e3f51217995fb94bbdc5937f79d0c2c566134597aabf03e322061864a9d2023f7e177564944854fa0aa7eef94ca742e66d0a694733d2c1cd17ec2300ae488ab7b53280fc17d77f765acd3ebc6bbdf1c8554a361994b44622bb019ac884d366a4de7013b4b3c51e732fe4746480ea42b80cf2954a67ab846526d340c0ea7e1b4ee5d0a07b05db2f933683d4ace8f401c3c10294da272820096730a58fc1085e84319b83ed142670d1a166beb5e96571979b74228593bc3a2b91152f1f242660c6d8bc556389d51e2556f88a46264ad2b724aa5c7342399d00c6ff004edca25783768144c553f262501ffa0569d778209e0b39db6c14d73617eaee4a693833983a4bbff9b04e8940e879d2b3f0d8ae209e504b2e8f1fbcc002cb2dc91a631d682443c75a2a30a04f4bf8b1f2203c883083ff7ad35eb261bae9986f277e10b75909eecfbb35a2eb47b4409500af0df3d096f27701c4803fb90b379619d187b28d8cf56015949480d839317ff10516752109e45b28667011f310c2b0c1fa9dc5dc4270dc4806e369b58510d8aef099f351d61ccc5debdc53435d8b3d10cf8d2ce7770ae87e47c5444d51c7b3ae7a1d3ad1852457025c13c799ad6c171628d48ef8edf3836777792ecc630877720989ade1a3b29d43890bee13843391f984e1cac704e2817d4cfe2d7ccab12827b657bfa048677625adfec958c6f3c3071b370909c662bd659adac9654b1ccb6e95bfeda1d2f128e4f32b5e657acdab42ec5fabd8fde3cdaa82ad88035c0cdeb7003ada528a5444d762711084ceaeb06f74b1ed0b400d4a263e007ec5a1a454258f72ef227a5db6bb67890c1e4ebbdaf8760c665201f433a42d1c863d65034fff04a73841294e5ed0fb61b823328fa9bdeccc74425648344752441d90ed465c278d537bc22071aeee18a55d83c88c4fb8c1f36cf26e1e0cd3e778b5abf3aa121813deb000e9c5c6aa6888f4040d24e702888cf803df95abba98737cdcbd041bdedcbf61f0c44a8058352eb65c79906d2ff97481da0b383088894c01405305592fa51fb1405a9378712c6733977ae93425a8b060272a51767c621e04643bc08e6f31c70b706991a1d1016ea19a24395871fe6f2bdc2c711ca83bc6cac474d670b54997d120e2ce9ab5e1ce66f2b17fd8d304672aafa5c50088d6b5802512edd19d20c736f2cf74eeac1ab3e0a9536ac57336664be23d08a8e23227efa529008de1d765b422506cab1bb6dd041e840234621403f282b8577b6b0c616f731927483172a4edb1d24ddf825bb58fc2b9ec704e46f72d9f04c674fc34e0d3705d1fc4e869065552bbf81c2bb30c3b18bb258bdd9864bdeb0f846107470d6f3aff5dc8493fed995226bd64be75b365eeb1f58dc941ef17452ab43878f07cfca54fb6dc42bbf52a1266ff5bf6d6d04ea7eea1f1a58896e0b731b36c8085a8dd8a84907fbb5bdfac609c04d579390b40a48a6436a9f90aa5fe82d40e13dd417880f7b46264b98041f07e243775318e0a91c52ca280cb0521f65b7694b8984a53cf0e1cd77eb58373a2add755f2a73b78926fe46a1530cbd213be96245133ea94318c8ce8f38e3c7e82fb9824602d80fa20dd3f1fff43a5cbedc8bba022cca9a3cf5e97cb1e80de54d18d57152f5b8431e91b2659bba76496a299ec126fade57e08f600d571d456ee71daaf2539f3696e912a909a7e0082f77339cabc49e3fcf11253c2ba3c4df70e1114a5112c491a136d17c80381566491d32d22991916609e421a2dbdddd43442d22eb78788efb1ea777628ec29466627c015022f27376a7dd2983501b5edbae790367b8bd34caf7f540e4eae56dd5c6e448a59c423ff0d962b5780a288a6730871c76729066f09a70bfa69426b5ba57aa64411fc82c312b53e69969a09c10a9a119c7ae61938f3c8aaf1c86d894e9d057e73c89791a3aa1796d8e83b0ceb66dfd25ab5fda93df1c33f0bbb8ab971fb13e3c28e1ad9fe26c695517f911904610a729877ec10a1610fdc9f15da09a004546b666f9f77dd1fea64e48dcfef65dd6602c3ebb761048a84659e8869a99c8dc5a8615854a55ce55d4b1243dade019e3ef067e7b07eed2414443926ce9d219d380f83731defd1ad2e282462531badb8df705544e22a7e1ce5b1359254001d40dec0cf00d635e3ffff6aee0c9d706721b6d0ae1e33662b607e692e68ea4c08fb93632c445dee54960cb11a5d26f9102a96a1532aa9cd27f44494237c5dee0c51f1f7a4cda49da0cb856e68089f9c424baf10e0e1037a01ed7c5836a090f63b1001b3f8004ceb38fade675068e8caeeb021823433090dcd771514da66ac9b5b3815cbf6e1eed15ca2bc76d234401a6259a232bfe132200e1fbc9e7dcf227695172ef8a1c5b5442ec2e0456a09c9972b50be91fafcf6f796b80fc9b39e83763f7abe4cc820ea774de13036a250a79070d972f2e7ade04785bba6e88ca3414c54c1349e71bf9c9f94bde948f69e64ad92796ff00d80c2d8b83d2f8f221d2e58a254a1946b0cca25a5c173f4e02eccf89c698621b394fbbf698b42aa8aac8405ac0620c55a0776c232c31c9915e646204e9922c0ae36860ca94110c8cd920ad7f0a96440496491f38e8b9c4780859406dcf1d1b00000000000000000000000000000000000000000000000000000000000000000f7019c1f4ad609f52e1f94e67441ff61e573dd2bc8b66849a8e36a7c71e2f82097def10025fffedc6bc59358e59eee042d409421e42e8752f1a1ee9871d9f09050f2ac8b09a442da82db485ce1e096d9ba28f08b2d43557e07139491d3346e316c7417424296ca07a620a559d8cd1d66dbb9aeef08d0d140e8776081190d44e14269e4ef01131cf182a6cd0e8e0f03fb1d6b3124e0c04f33984c94a2e54060c08559ebf1e57832e653ac16d44c173d2f9a5101ec4e6db8f435782854dda8e152405b86e1cd06c37c80997bf1448fe8b609a682a0d2dd320fe5e247d400710621acabd45c62c66f7d3cff9c6d003472d8449c2341cd22501db2190ea63c1c91f1df3aced4f93fff21c9975c3bc0c83d479d5b2f8038e5ac98c3c1b67fbebaa782c6a5305453e345ca396e2776d2c891e4ad74bb9f2164f0c12adad528b38b17623922c7061c76342c312a2ad5f8885edaaa8edce4bff3a026df9e821c2d9e29927d6332e0102e9d303ec0ff7e598a8e0adbe4909bb81e6228f82767706859e0411bf54ebe10a0b7f38ab2709e91dd92252ce0df292a5c339073d7bf93eaf552e0c794f136ac86d4b4e6bd6105fb6b2be544ed7c95926d32c11082ace46646ab20871629063e7150af040237aaafe792d5543823adf2a065b5c4e0520760ef053000000000000000000000000000000000000000000000000000000000000000012140a304f9ab2af34625256cf496aa8a43cf6bb886dd686aebe27dfa659c4dd14589f2ff7ddd1e3be2f7184b7e5e4c9a35394227cc013f6df62b287d15e3d7d2bbfce10bdb448101c5820c9075b4e0ca4a57c5178288cd4578a371a0085132c1687975eb5a0fc2c28cb1bb24fd6bc32217a9dc1050bee4b281ce646a04fa47805c2fdffb065d2f2947d255ef202e6641c4a9465b00006b7186a77261d3bcf500a33e3e0ac5eb690eb43c7bb77f87f07019a87af59bfc354e7de5afbb326405a00000000000000000000000000000000000000000000000000000000000000001b561c622a022160541aa7aceef7592c3678f80cda2738f5da474c3276bfd78b2c83cf6a1566c1070baaef1eeae9b55ca0c1cd46c6f72d0986d1f5c87b4b7e2617536f4ab08e42ad1a67cbb1bd408259a96cdc73133293af84d86750a749c40b014528c70d05508a5b3b58b41a09381be7174d4a84de8c22f7aacd4ba3f947fe1b5ddc0d0b745465a106348293e814d5d59c776269af8f4ab064cb2310c2389f1785665013cd3eeb1440dabdbe06d0502e26f8fdf859caf3850f29abe67a3aff26b7339a4d606686e0f9a5d2c1d5e566b0311a99f99495701ee4512c995b17490a9fcc7fef5f749ab7af223f516b29917eb1667391acfc78ac3ce4e80fc878641517d3d60ca6df555874f1c580aa81984e076009559c5a35a3ede1f2022afaa104aaee4ff87ac62835300c8388f46197aa6339049e49e65c350b3b198d9cfcab0d78afe15e280b34132074a797158853786d464eea0f2d181fcc547b9d69ae9718ad7d0f48a00a0223550a0265392d2097f106846646e032a85516514bfdbc962e38373dbd25c304cbb000ebb7d2bd589e750b831106a31a6750221391c1f36c2ca9a43eeb9b047a22592302274832e64d003c5d9329515d0179ec4ab38649bb054a5d44f3f23be72b5efce5d09cf962254a284dd29b932da2c7aa053fd1fb3902c2b8ebd8974d6f77b0d99b8b92a6a39dad69a30af83647edd5f14e3e625530210e2311f5736d14c43b58dd10ecb479e882ce1b34aded8dfe3e3935123bbce50011d958fceed03f420535c49e35720772abf1a8c711737bd86171c1abe8eb7f05206e579e520dd765c0c65112150c17a71781fd152022a929ba1ca245864ab21fbd1b5e8f6bca8551dc4c26770bb4634e2b273a4dff9b33fa8d2dfe588701e30495afcb0cde8d0167234604313563501a8f8e92799bce543cc0ca91572e7fc202d59ee886cd5064953ae17c15213db623219bcbbcb7de0be9d62efea39c3b2207a726145609d4931e5c58aaf28f49e79d8c8e3ae5a904dd17fb8c1ed62d357920c33c2039c79c184b8e4b8e37aefbaf8a5004d2ee787505e91f0f4b5956175e1a0558d998d768300d4d72aa6d51c01dee8879c6720fa015b41104b9bbbee9131a73ee76765e1755224cac6bdc11084d6254e3b718b2677e56332a6d7d200ca6158b12696532eb35e7d0fb35598a9b44bee43f4fa956e95c32128d43175109f51eb459f12fefd51f08a817ba6b9dcaa8b236417e305c707343aa8255eed4c6262ecf830ed08579d5f6057daa8a0c31ccd061dbf1d8069ec347c941870d449b060c2e6043113299905eedabf268bd288ac12498da70e23fe299cfbb87319e976528c5892b5aaf1f7cd17b6a9c4fdb1a252d3dafbdaa7c0cf136e9207c71611b440808dd45029a917aff55f5387f105a1d68fa33a450d182e21c0223525e43fa1f19c4d8b5128cdeb3aa8608153955d59e59ceb7edd3934c2fc9821b21647ec80217237f568ab3e58920fef8d807fd950165f1f0b889140652972ba3188db7b1b20e30dd6bfd3784a846af26789e66d7b092dfd2b550681d23fad3cad07f6c39990c4dec3173e0c62a239f302bc7de7866d12aadbbb1ca2f31e5b08d9b3cbc5cc20f57d484d518a7bf1991b477c5e4eb2fea3e38a446c1d39c90a01411cbfe49872edd9207bb720c4189917f1a5c9c3c09b45d33716a80982b4e1b286fac2ba1cc0ecfefdba185c0a5f4ad954872b44d459fba0271109ca64e44adb6085763262801fb368b65617daf8c12c25c8bbcc9d64204e672c7b86f8ee4816484d97cbd341d6e63d4e57b886d7e13388a54d9fbcb4783d8f981fbc4f4de6fac6caf15da57112b60520baa9b519255c7dd3222f4022d38d5578b419e3d527c2913190fdad12304f4a6c0ee03028409820744ef2c209f5f64f839111be0f520a58164a03f1e1dd602725213fc34688f4aeba24e4d7049c1cc00d0a854343b3228aa44fc60a72ceab6764ff445f59d541d1c663ad11d1783c4fe5b3871afdae56e5ff8e25f021f3e1eac9a0eb8f1959c7af3c13a53ccca7445c50bf70c07e4d24487a0d1113b1ea524a775901cb670ad57e9690d4cc0c1a76f7483957330879f671087731cee14a282bb8bbc106adcbd3b1b644e7ef941fc723d3cc9764599da48a33c1c800f1b6b4d0f90e624da9feb735d0f28e1f0a42dd56c7976fccc3b4d6fcd600fe2080a751da3254bc6cd4f1ee28a5400fd53a99eb47f3601fd8f30e61eda3a6541da2ed8f9a8a4f4212673b6a4d2b4ec6c6be1f591e1010cf28cfb169b832d055e1c040fe89536c0adbc159c806f808cd5579a0ee941e0aa05f87645571b2105c73c0465353631568dcc420390f3d38b379cf2da03a9fb831f0dce624af4c4b69c5810526b473a34e7d568481ac2ec149326cc86f52af9f1c3a4254bd71b816c722b0bc501544009539608745c303f7fda9017b0f429197c6e5783f3b1c657c1780d07807c0de5d71e1c5a84e85c23f1970aa65b64e67d072bb46fe434ed69c506b12cc46bfc8741e6d0f06579ee32cb1ca4d85e54f8a2536de47f25573f9003c30f2d5442331b41bf0f465b8ac39b2b7b6ae6e5e0e5b2a036155b79e532a1b3be1a198c9c869c434d8e9ab1d22ee4694083ec1dd95ebb72eb7cfd7d6a59a0562d8f130a53837a1eec683fe7c341f2330f38155026a5b0f497b60b9d65218e075d9823b35192370e83c9f058c229f888d6c85fbb84e34612a0a2191f25fa0c83c2b7";

        bytes memory proof = vm.ffi(input_proof);

        string[] memory input_instance_0 = new string[](3);
        input_instance_0[0] = "echo";
        input_instance_0[1] = "-n";
        input_instance_0[2] = "0x0000000000000000000000000000000000000000000000000000000000000000";

        bytes memory res_instance_0 = vm.ffi(input_instance_0);
        uint256 instance_0 = abi.decode(res_instance_0, (uint256));


        uint256[] memory instances = new uint256[](1);
        instances[0] = instance_0;

        bytes32 resultHash = keccak256(abi.encode(proof, instances));

        // commit result
        ci.commitResult(resultHash);
        (address committer, uint64 commitTime, uint64 revealTime) = ci.commits(resultHash);

        assertEq(committer, address(this));
        assertEq(commitTime, block.timestamp);
        assertEq(revealTime, 0);


        // mint and balance check
        vm.prank(address(1));
        ci.mint{value: 0.01 ether}(proof, instances);
    }


    function testFailAlreadyCommitResult() public {
        string[] memory input_proof = new string[](3);
        input_proof[0] = "echo";
        input_proof[1] = "-n";
        input_proof[2] = "0x000355d345e99f516a419d605c0037ce26284fc37dc73a7bdd08806267faca6113aa5a8f998df4c32ab041d61a27f1fcec4eddf33ff3c7272f8457a8ef5a0577234dd46c27651c5f6e30acc20183557429f13608565c9a8d14b0441f53a493d7295a6404eb18ffd6a92865138e832520cf592fe412f7684c3a36cef7185e34c102dac92cefa72eb5b812821d58f6e149a40b94e517364c532e715baea96264fa2c36057d8c92b7e7735a88f0f82190103a60cc55e3215b27c4669ca3842f55c30a07d8b5e2fc9d5f28c49dbc2e1c19cc5a0377a4389ce1ca8462ff55a7bfcf5d064e82f85b6354be39bde9c56ce951a75131c2643b5cfca1d33b47389aa935c720f1d10410dc7fe7fbc3b5f189207b7f0d6bdac7b6a03855314306ee85e014272ca6716e680f9973f6e2b7cba751b4a302db05decbe0168e351de72a9a199a61092b15c0d3159aa3cbb1336fe0cb0729df5473eca37b2148b4d825db7816bcab016d0dbce8543acdd8b3b9f4534487ab0da1fb2c43bf32028c345b42613079042cc23c66d2a7957c92b47c0447efeec51184ed33e066a8a39c0747a4513b8eaa061038755ae304246205dda071110a19490d026ecdfdd784da5d09b68921e2db11a85c7e2ac01424cb8a0dec005e3c06dbe5b181baba91939a96aadb704f9a7d13417c816325d52e19383055bdc765d744bdd929c44a48c2d6235f3033361c1f2eec33a25a084cff6f048f83b84e4743d41c93e7b36b06be4533775d2b5a03cd090440aef95913e9d9dafc68082b692bdbc1d58f16d17a4b8c11696fc45e7593093756c3e77f1782e9a591cc681e3968b9d5e40d0962d4b725baab7f53c5d7631346dcf5f620437a5c0c2798b43b28d40f5dd40bef8e3f24c502d3837058461d062a40852126acd8f81da3610150c01519e0c9a045f695cd6ddcbe683342a8df0df45d855befa336e9d5df3dd7281f6568128fd426ac6c0eea033d1383478cbe0e59d490b555d8b2d8b1397af3eefa51cc055470c824800cd8eff20e99b2336b1abb69a7e062059379bacaede4ca11a5936fc4fdb161fd6aece114933299d1b00a99f205d382201be73fb7718bd96ee9a0417ff2c94626aef85ed7b04aec04592cc175bcd4c37f95073cdf6f953dac18d47e74feedf6fba8f64ce2b0a142d7d222048a73297e669427ff6a0ccb02824c03e8dad6afa5001dfcbba685e465c67825b7dd40a144c5c813651bba54a1931fe036a67c1a98541df9126112362ec6171aa5cdc7d576849104b93f0f6d773ee7d5311a4642ff2aedca2c4182432b7fe22c46d1c948abcd76359ede358b2f7f46efdacbed49e0130208959403e8f72f9e0dd3a97a10d256e816e175af2b208413d03bf674e4c65fd14404b1b54863c1450b4418d088746aad957a2a5da6a0b6cd25c39ab88d507826079cf163732c1d4c05a3bb844e36bbf9d2c6def18330ebec250203ea8f93fb3084446b855b988e440f6930b6e74a33a9268e857536fffb5413ea33e1d965a4e7f3c19ebe60b747a623bb2d7d9f59c1bc728347ba4c688eeff48e617c1b413ca44c499dd8f94bfd601e56280be8a1a284bbcadcb796e7911da89e7daa9f8c11b923a53f55cfb8761a04e1df908501d04e63e6b600b1ec69e4ae2e3f51217995fb94bbdc5937f79d0c2c566134597aabf03e322061864a9d2023f7e177564944854fa0aa7eef94ca742e66d0a694733d2c1cd17ec2300ae488ab7b53280fc17d77f765acd3ebc6bbdf1c8554a361994b44622bb019ac884d366a4de7013b4b3c51e732fe4746480ea42b80cf2954a67ab846526d340c0ea7e1b4ee5d0a07b05db2f933683d4ace8f401c3c10294da272820096730a58fc1085e84319b83ed142670d1a166beb5e96571979b74228593bc3a2b91152f1f242660c6d8bc556389d51e2556f88a46264ad2b724aa5c7342399d00c6ff004edca25783768144c553f262501ffa0569d778209e0b39db6c14d73617eaee4a693833983a4bbff9b04e8940e879d2b3f0d8ae209e504b2e8f1fbcc002cb2dc91a631d682443c75a2a30a04f4bf8b1f2203c883083ff7ad35eb261bae9986f277e10b75909eecfbb35a2eb47b4409500af0df3d096f27701c4803fb90b379619d187b28d8cf56015949480d839317ff10516752109e45b28667011f310c2b0c1fa9dc5dc4270dc4806e369b58510d8aef099f351d61ccc5debdc53435d8b3d10cf8d2ce7770ae87e47c5444d51c7b3ae7a1d3ad1852457025c13c799ad6c171628d48ef8edf3836777792ecc630877720989ade1a3b29d43890bee13843391f984e1cac704e2817d4cfe2d7ccab12827b657bfa048677625adfec958c6f3c3071b370909c662bd659adac9654b1ccb6e95bfeda1d2f128e4f32b5e657acdab42ec5fabd8fde3cdaa82ad88035c0cdeb7003ada528a5444d762711084ceaeb06f74b1ed0b400d4a263e007ec5a1a454258f72ef227a5db6bb67890c1e4ebbdaf8760c665201f433a42d1c863d65034fff04a73841294e5ed0fb61b823328fa9bdeccc74425648344752441d90ed465c278d537bc22071aeee18a55d83c88c4fb8c1f36cf26e1e0cd3e778b5abf3aa121813deb000e9c5c6aa6888f4040d24e702888cf803df95abba98737cdcbd041bdedcbf61f0c44a8058352eb65c79906d2ff97481da0b383088894c01405305592fa51fb1405a9378712c6733977ae93425a8b060272a51767c621e04643bc08e6f31c70b706991a1d1016ea19a24395871fe6f2bdc2c711ca83bc6cac474d670b54997d120e2ce9ab5e1ce66f2b17fd8d304672aafa5c50088d6b5802512edd19d20c736f2cf74eeac1ab3e0a9536ac57336664be23d08a8e23227efa529008de1d765b422506cab1bb6dd041e840234621403f282b8577b6b0c616f731927483172a4edb1d24ddf825bb58fc2b9ec704e46f72d9f04c674fc34e0d3705d1fc4e869065552bbf81c2bb30c3b18bb258bdd9864bdeb0f846107470d6f3aff5dc8493fed995226bd64be75b365eeb1f58dc941ef17452ab43878f07cfca54fb6dc42bbf52a1266ff5bf6d6d04ea7eea1f1a58896e0b731b36c8085a8dd8a84907fbb5bdfac609c04d579390b40a48a6436a9f90aa5fe82d40e13dd417880f7b46264b98041f07e243775318e0a91c52ca280cb0521f65b7694b8984a53cf0e1cd77eb58373a2add755f2a73b78926fe46a1530cbd213be96245133ea94318c8ce8f38e3c7e82fb9824602d80fa20dd3f1fff43a5cbedc8bba022cca9a3cf5e97cb1e80de54d18d57152f5b8431e91b2659bba76496a299ec126fade57e08f600d571d456ee71daaf2539f3696e912a909a7e0082f77339cabc49e3fcf11253c2ba3c4df70e1114a5112c491a136d17c80381566491d32d22991916609e421a2dbdddd43442d22eb78788efb1ea777628ec29466627c015022f27376a7dd2983501b5edbae790367b8bd34caf7f540e4eae56dd5c6e448a59c423ff0d962b5780a288a6730871c76729066f09a70bfa69426b5ba57aa64411fc82c312b53e69969a09c10a9a119c7ae61938f3c8aaf1c86d894e9d057e73c89791a3aa1796d8e83b0ceb66dfd25ab5fda93df1c33f0bbb8ab971fb13e3c28e1ad9fe26c695517f911904610a729877ec10a1610fdc9f15da09a004546b666f9f77dd1fea64e48dcfef65dd6602c3ebb761048a84659e8869a99c8dc5a8615854a55ce55d4b1243dade019e3ef067e7b07eed2414443926ce9d219d380f83731defd1ad2e282462531badb8df705544e22a7e1ce5b1359254001d40dec0cf00d635e3ffff6aee0c9d706721b6d0ae1e33662b607e692e68ea4c08fb93632c445dee54960cb11a5d26f9102a96a1532aa9cd27f44494237c5dee0c51f1f7a4cda49da0cb856e68089f9c424baf10e0e1037a01ed7c5836a090f63b1001b3f8004ceb38fade675068e8caeeb021823433090dcd771514da66ac9b5b3815cbf6e1eed15ca2bc76d234401a6259a232bfe132200e1fbc9e7dcf227695172ef8a1c5b5442ec2e0456a09c9972b50be91fafcf6f796b80fc9b39e83763f7abe4cc820ea774de13036a250a79070d972f2e7ade04785bba6e88ca3414c54c1349e71bf9c9f94bde948f69e64ad92796ff00d80c2d8b83d2f8f221d2e58a254a1946b0cca25a5c173f4e02eccf89c698621b394fbbf698b42aa8aac8405ac0620c55a0776c232c31c9915e646204e9922c0ae36860ca94110c8cd920ad7f0a96440496491f38e8b9c4780859406dcf1d1b00000000000000000000000000000000000000000000000000000000000000000f7019c1f4ad609f52e1f94e67441ff61e573dd2bc8b66849a8e36a7c71e2f82097def10025fffedc6bc59358e59eee042d409421e42e8752f1a1ee9871d9f09050f2ac8b09a442da82db485ce1e096d9ba28f08b2d43557e07139491d3346e316c7417424296ca07a620a559d8cd1d66dbb9aeef08d0d140e8776081190d44e14269e4ef01131cf182a6cd0e8e0f03fb1d6b3124e0c04f33984c94a2e54060c08559ebf1e57832e653ac16d44c173d2f9a5101ec4e6db8f435782854dda8e152405b86e1cd06c37c80997bf1448fe8b609a682a0d2dd320fe5e247d400710621acabd45c62c66f7d3cff9c6d003472d8449c2341cd22501db2190ea63c1c91f1df3aced4f93fff21c9975c3bc0c83d479d5b2f8038e5ac98c3c1b67fbebaa782c6a5305453e345ca396e2776d2c891e4ad74bb9f2164f0c12adad528b38b17623922c7061c76342c312a2ad5f8885edaaa8edce4bff3a026df9e821c2d9e29927d6332e0102e9d303ec0ff7e598a8e0adbe4909bb81e6228f82767706859e0411bf54ebe10a0b7f38ab2709e91dd92252ce0df292a5c339073d7bf93eaf552e0c794f136ac86d4b4e6bd6105fb6b2be544ed7c95926d32c11082ace46646ab20871629063e7150af040237aaafe792d5543823adf2a065b5c4e0520760ef053000000000000000000000000000000000000000000000000000000000000000012140a304f9ab2af34625256cf496aa8a43cf6bb886dd686aebe27dfa659c4dd14589f2ff7ddd1e3be2f7184b7e5e4c9a35394227cc013f6df62b287d15e3d7d2bbfce10bdb448101c5820c9075b4e0ca4a57c5178288cd4578a371a0085132c1687975eb5a0fc2c28cb1bb24fd6bc32217a9dc1050bee4b281ce646a04fa47805c2fdffb065d2f2947d255ef202e6641c4a9465b00006b7186a77261d3bcf500a33e3e0ac5eb690eb43c7bb77f87f07019a87af59bfc354e7de5afbb326405a00000000000000000000000000000000000000000000000000000000000000001b561c622a022160541aa7aceef7592c3678f80cda2738f5da474c3276bfd78b2c83cf6a1566c1070baaef1eeae9b55ca0c1cd46c6f72d0986d1f5c87b4b7e2617536f4ab08e42ad1a67cbb1bd408259a96cdc73133293af84d86750a749c40b014528c70d05508a5b3b58b41a09381be7174d4a84de8c22f7aacd4ba3f947fe1b5ddc0d0b745465a106348293e814d5d59c776269af8f4ab064cb2310c2389f1785665013cd3eeb1440dabdbe06d0502e26f8fdf859caf3850f29abe67a3aff26b7339a4d606686e0f9a5d2c1d5e566b0311a99f99495701ee4512c995b17490a9fcc7fef5f749ab7af223f516b29917eb1667391acfc78ac3ce4e80fc878641517d3d60ca6df555874f1c580aa81984e076009559c5a35a3ede1f2022afaa104aaee4ff87ac62835300c8388f46197aa6339049e49e65c350b3b198d9cfcab0d78afe15e280b34132074a797158853786d464eea0f2d181fcc547b9d69ae9718ad7d0f48a00a0223550a0265392d2097f106846646e032a85516514bfdbc962e38373dbd25c304cbb000ebb7d2bd589e750b831106a31a6750221391c1f36c2ca9a43eeb9b047a22592302274832e64d003c5d9329515d0179ec4ab38649bb054a5d44f3f23be72b5efce5d09cf962254a284dd29b932da2c7aa053fd1fb3902c2b8ebd8974d6f77b0d99b8b92a6a39dad69a30af83647edd5f14e3e625530210e2311f5736d14c43b58dd10ecb479e882ce1b34aded8dfe3e3935123bbce50011d958fceed03f420535c49e35720772abf1a8c711737bd86171c1abe8eb7f05206e579e520dd765c0c65112150c17a71781fd152022a929ba1ca245864ab21fbd1b5e8f6bca8551dc4c26770bb4634e2b273a4dff9b33fa8d2dfe588701e30495afcb0cde8d0167234604313563501a8f8e92799bce543cc0ca91572e7fc202d59ee886cd5064953ae17c15213db623219bcbbcb7de0be9d62efea39c3b2207a726145609d4931e5c58aaf28f49e79d8c8e3ae5a904dd17fb8c1ed62d357920c33c2039c79c184b8e4b8e37aefbaf8a5004d2ee787505e91f0f4b5956175e1a0558d998d768300d4d72aa6d51c01dee8879c6720fa015b41104b9bbbee9131a73ee76765e1755224cac6bdc11084d6254e3b718b2677e56332a6d7d200ca6158b12696532eb35e7d0fb35598a9b44bee43f4fa956e95c32128d43175109f51eb459f12fefd51f08a817ba6b9dcaa8b236417e305c707343aa8255eed4c6262ecf830ed08579d5f6057daa8a0c31ccd061dbf1d8069ec347c941870d449b060c2e6043113299905eedabf268bd288ac12498da70e23fe299cfbb87319e976528c5892b5aaf1f7cd17b6a9c4fdb1a252d3dafbdaa7c0cf136e9207c71611b440808dd45029a917aff55f5387f105a1d68fa33a450d182e21c0223525e43fa1f19c4d8b5128cdeb3aa8608153955d59e59ceb7edd3934c2fc9821b21647ec80217237f568ab3e58920fef8d807fd950165f1f0b889140652972ba3188db7b1b20e30dd6bfd3784a846af26789e66d7b092dfd2b550681d23fad3cad07f6c39990c4dec3173e0c62a239f302bc7de7866d12aadbbb1ca2f31e5b08d9b3cbc5cc20f57d484d518a7bf1991b477c5e4eb2fea3e38a446c1d39c90a01411cbfe49872edd9207bb720c4189917f1a5c9c3c09b45d33716a80982b4e1b286fac2ba1cc0ecfefdba185c0a5f4ad954872b44d459fba0271109ca64e44adb6085763262801fb368b65617daf8c12c25c8bbcc9d64204e672c7b86f8ee4816484d97cbd341d6e63d4e57b886d7e13388a54d9fbcb4783d8f981fbc4f4de6fac6caf15da57112b60520baa9b519255c7dd3222f4022d38d5578b419e3d527c2913190fdad12304f4a6c0ee03028409820744ef2c209f5f64f839111be0f520a58164a03f1e1dd602725213fc34688f4aeba24e4d7049c1cc00d0a854343b3228aa44fc60a72ceab6764ff445f59d541d1c663ad11d1783c4fe5b3871afdae56e5ff8e25f021f3e1eac9a0eb8f1959c7af3c13a53ccca7445c50bf70c07e4d24487a0d1113b1ea524a775901cb670ad57e9690d4cc0c1a76f7483957330879f671087731cee14a282bb8bbc106adcbd3b1b644e7ef941fc723d3cc9764599da48a33c1c800f1b6b4d0f90e624da9feb735d0f28e1f0a42dd56c7976fccc3b4d6fcd600fe2080a751da3254bc6cd4f1ee28a5400fd53a99eb47f3601fd8f30e61eda3a6541da2ed8f9a8a4f4212673b6a4d2b4ec6c6be1f591e1010cf28cfb169b832d055e1c040fe89536c0adbc159c806f808cd5579a0ee941e0aa05f87645571b2105c73c0465353631568dcc420390f3d38b379cf2da03a9fb831f0dce624af4c4b69c5810526b473a34e7d568481ac2ec149326cc86f52af9f1c3a4254bd71b816c722b0bc501544009539608745c303f7fda9017b0f429197c6e5783f3b1c657c1780d07807c0de5d71e1c5a84e85c23f1970aa65b64e67d072bb46fe434ed69c506b12cc46bfc8741e6d0f06579ee32cb1ca4d85e54f8a2536de47f25573f9003c30f2d5442331b41bf0f465b8ac39b2b7b6ae6e5e0e5b2a036155b79e532a1b3be1a198c9c869c434d8e9ab1d22ee4694083ec1dd95ebb72eb7cfd7d6a59a0562d8f130a53837a1eec683fe7c341f2330f38155026a5b0f497b60b9d65218e075d9823b35192370e83c9f058c229f888d6c85fbb84e34612a0a2191f25fa0c83c2b7";

        bytes memory proof = vm.ffi(input_proof);

        string[] memory input_instance_0 = new string[](3);
        input_instance_0[0] = "echo";
        input_instance_0[1] = "-n";
        input_instance_0[2] = "0x0000000000000000000000000000000000000000000000000000000000000000";

        bytes memory res_instance_0 = vm.ffi(input_instance_0);
        uint256 instance_0 = abi.decode(res_instance_0, (uint256));


        uint256[] memory instances = new uint256[](1);
        instances[0] = instance_0;

        bytes32 resultHash = keccak256(abi.encode(proof, instances));

        // commit result
        ci.commitResult(resultHash);
        ci.commitResult(resultHash);
    }

    function testFailMintTwice() public {
        string[] memory input_proof = new string[](3);
        input_proof[0] = "echo";
        input_proof[1] = "-n";
        input_proof[2] = "0x000355d345e99f516a419d605c0037ce26284fc37dc73a7bdd08806267faca6113aa5a8f998df4c32ab041d61a27f1fcec4eddf33ff3c7272f8457a8ef5a0577234dd46c27651c5f6e30acc20183557429f13608565c9a8d14b0441f53a493d7295a6404eb18ffd6a92865138e832520cf592fe412f7684c3a36cef7185e34c102dac92cefa72eb5b812821d58f6e149a40b94e517364c532e715baea96264fa2c36057d8c92b7e7735a88f0f82190103a60cc55e3215b27c4669ca3842f55c30a07d8b5e2fc9d5f28c49dbc2e1c19cc5a0377a4389ce1ca8462ff55a7bfcf5d064e82f85b6354be39bde9c56ce951a75131c2643b5cfca1d33b47389aa935c720f1d10410dc7fe7fbc3b5f189207b7f0d6bdac7b6a03855314306ee85e014272ca6716e680f9973f6e2b7cba751b4a302db05decbe0168e351de72a9a199a61092b15c0d3159aa3cbb1336fe0cb0729df5473eca37b2148b4d825db7816bcab016d0dbce8543acdd8b3b9f4534487ab0da1fb2c43bf32028c345b42613079042cc23c66d2a7957c92b47c0447efeec51184ed33e066a8a39c0747a4513b8eaa061038755ae304246205dda071110a19490d026ecdfdd784da5d09b68921e2db11a85c7e2ac01424cb8a0dec005e3c06dbe5b181baba91939a96aadb704f9a7d13417c816325d52e19383055bdc765d744bdd929c44a48c2d6235f3033361c1f2eec33a25a084cff6f048f83b84e4743d41c93e7b36b06be4533775d2b5a03cd090440aef95913e9d9dafc68082b692bdbc1d58f16d17a4b8c11696fc45e7593093756c3e77f1782e9a591cc681e3968b9d5e40d0962d4b725baab7f53c5d7631346dcf5f620437a5c0c2798b43b28d40f5dd40bef8e3f24c502d3837058461d062a40852126acd8f81da3610150c01519e0c9a045f695cd6ddcbe683342a8df0df45d855befa336e9d5df3dd7281f6568128fd426ac6c0eea033d1383478cbe0e59d490b555d8b2d8b1397af3eefa51cc055470c824800cd8eff20e99b2336b1abb69a7e062059379bacaede4ca11a5936fc4fdb161fd6aece114933299d1b00a99f205d382201be73fb7718bd96ee9a0417ff2c94626aef85ed7b04aec04592cc175bcd4c37f95073cdf6f953dac18d47e74feedf6fba8f64ce2b0a142d7d222048a73297e669427ff6a0ccb02824c03e8dad6afa5001dfcbba685e465c67825b7dd40a144c5c813651bba54a1931fe036a67c1a98541df9126112362ec6171aa5cdc7d576849104b93f0f6d773ee7d5311a4642ff2aedca2c4182432b7fe22c46d1c948abcd76359ede358b2f7f46efdacbed49e0130208959403e8f72f9e0dd3a97a10d256e816e175af2b208413d03bf674e4c65fd14404b1b54863c1450b4418d088746aad957a2a5da6a0b6cd25c39ab88d507826079cf163732c1d4c05a3bb844e36bbf9d2c6def18330ebec250203ea8f93fb3084446b855b988e440f6930b6e74a33a9268e857536fffb5413ea33e1d965a4e7f3c19ebe60b747a623bb2d7d9f59c1bc728347ba4c688eeff48e617c1b413ca44c499dd8f94bfd601e56280be8a1a284bbcadcb796e7911da89e7daa9f8c11b923a53f55cfb8761a04e1df908501d04e63e6b600b1ec69e4ae2e3f51217995fb94bbdc5937f79d0c2c566134597aabf03e322061864a9d2023f7e177564944854fa0aa7eef94ca742e66d0a694733d2c1cd17ec2300ae488ab7b53280fc17d77f765acd3ebc6bbdf1c8554a361994b44622bb019ac884d366a4de7013b4b3c51e732fe4746480ea42b80cf2954a67ab846526d340c0ea7e1b4ee5d0a07b05db2f933683d4ace8f401c3c10294da272820096730a58fc1085e84319b83ed142670d1a166beb5e96571979b74228593bc3a2b91152f1f242660c6d8bc556389d51e2556f88a46264ad2b724aa5c7342399d00c6ff004edca25783768144c553f262501ffa0569d778209e0b39db6c14d73617eaee4a693833983a4bbff9b04e8940e879d2b3f0d8ae209e504b2e8f1fbcc002cb2dc91a631d682443c75a2a30a04f4bf8b1f2203c883083ff7ad35eb261bae9986f277e10b75909eecfbb35a2eb47b4409500af0df3d096f27701c4803fb90b379619d187b28d8cf56015949480d839317ff10516752109e45b28667011f310c2b0c1fa9dc5dc4270dc4806e369b58510d8aef099f351d61ccc5debdc53435d8b3d10cf8d2ce7770ae87e47c5444d51c7b3ae7a1d3ad1852457025c13c799ad6c171628d48ef8edf3836777792ecc630877720989ade1a3b29d43890bee13843391f984e1cac704e2817d4cfe2d7ccab12827b657bfa048677625adfec958c6f3c3071b370909c662bd659adac9654b1ccb6e95bfeda1d2f128e4f32b5e657acdab42ec5fabd8fde3cdaa82ad88035c0cdeb7003ada528a5444d762711084ceaeb06f74b1ed0b400d4a263e007ec5a1a454258f72ef227a5db6bb67890c1e4ebbdaf8760c665201f433a42d1c863d65034fff04a73841294e5ed0fb61b823328fa9bdeccc74425648344752441d90ed465c278d537bc22071aeee18a55d83c88c4fb8c1f36cf26e1e0cd3e778b5abf3aa121813deb000e9c5c6aa6888f4040d24e702888cf803df95abba98737cdcbd041bdedcbf61f0c44a8058352eb65c79906d2ff97481da0b383088894c01405305592fa51fb1405a9378712c6733977ae93425a8b060272a51767c621e04643bc08e6f31c70b706991a1d1016ea19a24395871fe6f2bdc2c711ca83bc6cac474d670b54997d120e2ce9ab5e1ce66f2b17fd8d304672aafa5c50088d6b5802512edd19d20c736f2cf74eeac1ab3e0a9536ac57336664be23d08a8e23227efa529008de1d765b422506cab1bb6dd041e840234621403f282b8577b6b0c616f731927483172a4edb1d24ddf825bb58fc2b9ec704e46f72d9f04c674fc34e0d3705d1fc4e869065552bbf81c2bb30c3b18bb258bdd9864bdeb0f846107470d6f3aff5dc8493fed995226bd64be75b365eeb1f58dc941ef17452ab43878f07cfca54fb6dc42bbf52a1266ff5bf6d6d04ea7eea1f1a58896e0b731b36c8085a8dd8a84907fbb5bdfac609c04d579390b40a48a6436a9f90aa5fe82d40e13dd417880f7b46264b98041f07e243775318e0a91c52ca280cb0521f65b7694b8984a53cf0e1cd77eb58373a2add755f2a73b78926fe46a1530cbd213be96245133ea94318c8ce8f38e3c7e82fb9824602d80fa20dd3f1fff43a5cbedc8bba022cca9a3cf5e97cb1e80de54d18d57152f5b8431e91b2659bba76496a299ec126fade57e08f600d571d456ee71daaf2539f3696e912a909a7e0082f77339cabc49e3fcf11253c2ba3c4df70e1114a5112c491a136d17c80381566491d32d22991916609e421a2dbdddd43442d22eb78788efb1ea777628ec29466627c015022f27376a7dd2983501b5edbae790367b8bd34caf7f540e4eae56dd5c6e448a59c423ff0d962b5780a288a6730871c76729066f09a70bfa69426b5ba57aa64411fc82c312b53e69969a09c10a9a119c7ae61938f3c8aaf1c86d894e9d057e73c89791a3aa1796d8e83b0ceb66dfd25ab5fda93df1c33f0bbb8ab971fb13e3c28e1ad9fe26c695517f911904610a729877ec10a1610fdc9f15da09a004546b666f9f77dd1fea64e48dcfef65dd6602c3ebb761048a84659e8869a99c8dc5a8615854a55ce55d4b1243dade019e3ef067e7b07eed2414443926ce9d219d380f83731defd1ad2e282462531badb8df705544e22a7e1ce5b1359254001d40dec0cf00d635e3ffff6aee0c9d706721b6d0ae1e33662b607e692e68ea4c08fb93632c445dee54960cb11a5d26f9102a96a1532aa9cd27f44494237c5dee0c51f1f7a4cda49da0cb856e68089f9c424baf10e0e1037a01ed7c5836a090f63b1001b3f8004ceb38fade675068e8caeeb021823433090dcd771514da66ac9b5b3815cbf6e1eed15ca2bc76d234401a6259a232bfe132200e1fbc9e7dcf227695172ef8a1c5b5442ec2e0456a09c9972b50be91fafcf6f796b80fc9b39e83763f7abe4cc820ea774de13036a250a79070d972f2e7ade04785bba6e88ca3414c54c1349e71bf9c9f94bde948f69e64ad92796ff00d80c2d8b83d2f8f221d2e58a254a1946b0cca25a5c173f4e02eccf89c698621b394fbbf698b42aa8aac8405ac0620c55a0776c232c31c9915e646204e9922c0ae36860ca94110c8cd920ad7f0a96440496491f38e8b9c4780859406dcf1d1b00000000000000000000000000000000000000000000000000000000000000000f7019c1f4ad609f52e1f94e67441ff61e573dd2bc8b66849a8e36a7c71e2f82097def10025fffedc6bc59358e59eee042d409421e42e8752f1a1ee9871d9f09050f2ac8b09a442da82db485ce1e096d9ba28f08b2d43557e07139491d3346e316c7417424296ca07a620a559d8cd1d66dbb9aeef08d0d140e8776081190d44e14269e4ef01131cf182a6cd0e8e0f03fb1d6b3124e0c04f33984c94a2e54060c08559ebf1e57832e653ac16d44c173d2f9a5101ec4e6db8f435782854dda8e152405b86e1cd06c37c80997bf1448fe8b609a682a0d2dd320fe5e247d400710621acabd45c62c66f7d3cff9c6d003472d8449c2341cd22501db2190ea63c1c91f1df3aced4f93fff21c9975c3bc0c83d479d5b2f8038e5ac98c3c1b67fbebaa782c6a5305453e345ca396e2776d2c891e4ad74bb9f2164f0c12adad528b38b17623922c7061c76342c312a2ad5f8885edaaa8edce4bff3a026df9e821c2d9e29927d6332e0102e9d303ec0ff7e598a8e0adbe4909bb81e6228f82767706859e0411bf54ebe10a0b7f38ab2709e91dd92252ce0df292a5c339073d7bf93eaf552e0c794f136ac86d4b4e6bd6105fb6b2be544ed7c95926d32c11082ace46646ab20871629063e7150af040237aaafe792d5543823adf2a065b5c4e0520760ef053000000000000000000000000000000000000000000000000000000000000000012140a304f9ab2af34625256cf496aa8a43cf6bb886dd686aebe27dfa659c4dd14589f2ff7ddd1e3be2f7184b7e5e4c9a35394227cc013f6df62b287d15e3d7d2bbfce10bdb448101c5820c9075b4e0ca4a57c5178288cd4578a371a0085132c1687975eb5a0fc2c28cb1bb24fd6bc32217a9dc1050bee4b281ce646a04fa47805c2fdffb065d2f2947d255ef202e6641c4a9465b00006b7186a77261d3bcf500a33e3e0ac5eb690eb43c7bb77f87f07019a87af59bfc354e7de5afbb326405a00000000000000000000000000000000000000000000000000000000000000001b561c622a022160541aa7aceef7592c3678f80cda2738f5da474c3276bfd78b2c83cf6a1566c1070baaef1eeae9b55ca0c1cd46c6f72d0986d1f5c87b4b7e2617536f4ab08e42ad1a67cbb1bd408259a96cdc73133293af84d86750a749c40b014528c70d05508a5b3b58b41a09381be7174d4a84de8c22f7aacd4ba3f947fe1b5ddc0d0b745465a106348293e814d5d59c776269af8f4ab064cb2310c2389f1785665013cd3eeb1440dabdbe06d0502e26f8fdf859caf3850f29abe67a3aff26b7339a4d606686e0f9a5d2c1d5e566b0311a99f99495701ee4512c995b17490a9fcc7fef5f749ab7af223f516b29917eb1667391acfc78ac3ce4e80fc878641517d3d60ca6df555874f1c580aa81984e076009559c5a35a3ede1f2022afaa104aaee4ff87ac62835300c8388f46197aa6339049e49e65c350b3b198d9cfcab0d78afe15e280b34132074a797158853786d464eea0f2d181fcc547b9d69ae9718ad7d0f48a00a0223550a0265392d2097f106846646e032a85516514bfdbc962e38373dbd25c304cbb000ebb7d2bd589e750b831106a31a6750221391c1f36c2ca9a43eeb9b047a22592302274832e64d003c5d9329515d0179ec4ab38649bb054a5d44f3f23be72b5efce5d09cf962254a284dd29b932da2c7aa053fd1fb3902c2b8ebd8974d6f77b0d99b8b92a6a39dad69a30af83647edd5f14e3e625530210e2311f5736d14c43b58dd10ecb479e882ce1b34aded8dfe3e3935123bbce50011d958fceed03f420535c49e35720772abf1a8c711737bd86171c1abe8eb7f05206e579e520dd765c0c65112150c17a71781fd152022a929ba1ca245864ab21fbd1b5e8f6bca8551dc4c26770bb4634e2b273a4dff9b33fa8d2dfe588701e30495afcb0cde8d0167234604313563501a8f8e92799bce543cc0ca91572e7fc202d59ee886cd5064953ae17c15213db623219bcbbcb7de0be9d62efea39c3b2207a726145609d4931e5c58aaf28f49e79d8c8e3ae5a904dd17fb8c1ed62d357920c33c2039c79c184b8e4b8e37aefbaf8a5004d2ee787505e91f0f4b5956175e1a0558d998d768300d4d72aa6d51c01dee8879c6720fa015b41104b9bbbee9131a73ee76765e1755224cac6bdc11084d6254e3b718b2677e56332a6d7d200ca6158b12696532eb35e7d0fb35598a9b44bee43f4fa956e95c32128d43175109f51eb459f12fefd51f08a817ba6b9dcaa8b236417e305c707343aa8255eed4c6262ecf830ed08579d5f6057daa8a0c31ccd061dbf1d8069ec347c941870d449b060c2e6043113299905eedabf268bd288ac12498da70e23fe299cfbb87319e976528c5892b5aaf1f7cd17b6a9c4fdb1a252d3dafbdaa7c0cf136e9207c71611b440808dd45029a917aff55f5387f105a1d68fa33a450d182e21c0223525e43fa1f19c4d8b5128cdeb3aa8608153955d59e59ceb7edd3934c2fc9821b21647ec80217237f568ab3e58920fef8d807fd950165f1f0b889140652972ba3188db7b1b20e30dd6bfd3784a846af26789e66d7b092dfd2b550681d23fad3cad07f6c39990c4dec3173e0c62a239f302bc7de7866d12aadbbb1ca2f31e5b08d9b3cbc5cc20f57d484d518a7bf1991b477c5e4eb2fea3e38a446c1d39c90a01411cbfe49872edd9207bb720c4189917f1a5c9c3c09b45d33716a80982b4e1b286fac2ba1cc0ecfefdba185c0a5f4ad954872b44d459fba0271109ca64e44adb6085763262801fb368b65617daf8c12c25c8bbcc9d64204e672c7b86f8ee4816484d97cbd341d6e63d4e57b886d7e13388a54d9fbcb4783d8f981fbc4f4de6fac6caf15da57112b60520baa9b519255c7dd3222f4022d38d5578b419e3d527c2913190fdad12304f4a6c0ee03028409820744ef2c209f5f64f839111be0f520a58164a03f1e1dd602725213fc34688f4aeba24e4d7049c1cc00d0a854343b3228aa44fc60a72ceab6764ff445f59d541d1c663ad11d1783c4fe5b3871afdae56e5ff8e25f021f3e1eac9a0eb8f1959c7af3c13a53ccca7445c50bf70c07e4d24487a0d1113b1ea524a775901cb670ad57e9690d4cc0c1a76f7483957330879f671087731cee14a282bb8bbc106adcbd3b1b644e7ef941fc723d3cc9764599da48a33c1c800f1b6b4d0f90e624da9feb735d0f28e1f0a42dd56c7976fccc3b4d6fcd600fe2080a751da3254bc6cd4f1ee28a5400fd53a99eb47f3601fd8f30e61eda3a6541da2ed8f9a8a4f4212673b6a4d2b4ec6c6be1f591e1010cf28cfb169b832d055e1c040fe89536c0adbc159c806f808cd5579a0ee941e0aa05f87645571b2105c73c0465353631568dcc420390f3d38b379cf2da03a9fb831f0dce624af4c4b69c5810526b473a34e7d568481ac2ec149326cc86f52af9f1c3a4254bd71b816c722b0bc501544009539608745c303f7fda9017b0f429197c6e5783f3b1c657c1780d07807c0de5d71e1c5a84e85c23f1970aa65b64e67d072bb46fe434ed69c506b12cc46bfc8741e6d0f06579ee32cb1ca4d85e54f8a2536de47f25573f9003c30f2d5442331b41bf0f465b8ac39b2b7b6ae6e5e0e5b2a036155b79e532a1b3be1a198c9c869c434d8e9ab1d22ee4694083ec1dd95ebb72eb7cfd7d6a59a0562d8f130a53837a1eec683fe7c341f2330f38155026a5b0f497b60b9d65218e075d9823b35192370e83c9f058c229f888d6c85fbb84e34612a0a2191f25fa0c83c2b7";

        bytes memory proof = vm.ffi(input_proof);

        string[] memory input_instance_0 = new string[](3);
        input_instance_0[0] = "echo";
        input_instance_0[1] = "-n";
        input_instance_0[2] = "0x0000000000000000000000000000000000000000000000000000000000000000";

        bytes memory res_instance_0 = vm.ffi(input_instance_0);
        uint256 instance_0 = abi.decode(res_instance_0, (uint256));


        uint256[] memory instances = new uint256[](1);
        instances[0] = instance_0;

        bytes32 resultHash = keccak256(abi.encode(proof, instances));

        // commit result
        ci.commitResult(resultHash);
        (address committer, uint64 commitTime, uint64 revealTime) = ci.commits(resultHash);

        assertEq(committer, address(this));
        assertEq(commitTime, block.timestamp);
        assertEq(revealTime, 0);


        // mint and balance check
        ci.mint{value: 0.01 ether}(proof, instances);
        ci.mint{value: 0.01 ether}(proof, instances);
    }

    function testFailMintNoMoney() public {
        string[] memory input_proof = new string[](3);
        input_proof[0] = "echo";
        input_proof[1] = "-n";
        input_proof[2] = "0x127dfd437c3bb2d7d35ce8eb6bdf58d8550cab28810fa73dd54a5732ec7f122028dd6d0e677375415a2372130a0ed642255d6c578c70613482da0bb72fbfe6f90754f8fc4b495f69a66e076b6dec4ce3cde78937cdce9807969281a294464c831b7fc0d92248fb651a9d00fcf74442aa79fbf143cc5d70a60007c9511ca0f4bc2dae61c30a70130f9a2fbd2a936b9aeca7b58c8f73a13fd349557d713c072e61198e07ee161d96b9cddf2442b9827549b6f71cc74fcd5bfbf9c5181a8816d4f506b7657bc4dd2f32911915d63ebfa27d2c5bcf85fceb33b1062d063980822d8811fec21411d75066ec8f408adfb0b251f4b63dc41507991f5f150581c125e7d41e9070dd0cddab9b22c2ab55d6faac3ca9b567a0858c30f22445341c442c89c213f028453b6c5c3ba35a858c05839fcbc7bfb28e3f1e53cb877358f99b541d360c0d425807e98223f1344eb0e532e65e691cb2141638295efd5c0b39bd53957a219dacde62c3cb3a5070a3c30f086bbb1428a8d1cd8c6ec1058b91bdec0958d40056bcff41f1086758e26e2f7759b321581088135d0f86b8284a2add79d4771818990631cea0c935b7df6ec1a3ea83f9eadc3472bfdd4333f5557884d1deb8031f700ee94ab45c69b53d27fbdf65e9672689f9a1b6b83a95fc34eb7d3bdcb3ad2667d1204a38a760d30eb0df2091eb5c0ba50e8e74272dff1cefa8465f983be30ecc0bc425e62729bd6946a9ae8ce8f79dd07ad78fcf8228678020239e2c73440a3d08000d2dbf55355be14fb8bb6cab7aff61d94a32bc7fbca5ca861c83b66514beb14674c1437a16e0f5ed1d10d1e9f42a0bff64b6142996629c9dc2d812411fa05f87b2d5608091841c6f73e2ec17748c821bbaadf13bb89199d38a01bc53091ad6627324f2471fc0caed422fd79f0412d21fef9ad9630a9adbd499b9d4680a4e12549f017415ebfba6491481221a9fa810576cb1247eebb8f9748bfd0b87062a40852126acd8f81da3610150c01519e0c9a045f695cd6ddcbe683342a8df0df45d855befa336e9d5df3dd7281f6568128fd426ac6c0eea033d1383478cbe0f96ba0ae59901cc6fa576d2978ec2587e0ccfac12a1962dd3863d8113a3f0bc2a969f292ec53f31a5aaebffc18c609ce6465cdc571bb45fcbacc1258c76b76f2becc2e8f9657338e9c719e23941ab2aff1f30df11c2d9aafff78b0271a977c01941cdcfa6018722be05bab66ccc60142290a8f5cb1bc345bf2d5beb49da296d0107a00bb05d9de265ecfd78a9a05e00d50e1f50ed29b4c19ac9387366b1dae016b74f5767b2726d2ffebbad313ceca912f1e8311dd58199e2092eba8b71e54f14e4552823be36e66f2fc89bbe6230980b5f1eaa09cbae3ee703daf2fb79853f2b930f15010c77656459d1099e0bcd6127ea97b52703c5ac6fbe40e8d1d6fe010892f8f64818ac1eda346ec074a92da946662cf54d233be24cd72f5fe5d9259b1f611aecca800cd02eaadf4154b7b959f3f674f2bd61defe4bb0b169db8f43172fe2e63be27503462d55b63a4c07c5a74110c9bc32228c0b7758cd875ec5506812de06231ee93cb389d215b9974306ba87d9afe4e0178eafd45826ba750ff4bb18eede46082a650f208765812bf109412c51b8bf405c22d259a81ccb01d22aec1c2137bd486cf26b08f0df56250c8f341d2b32045f24d89f687b4ae03f13c2220bec0fcb25e6493ab198bec3324c5cfaff65a97b58062cb23ed4157de2fa06a41430d178fb08e02ec967cd3276a0b9feead0484609f36f864489cb734c4763c2188535389cf1d7973e743c3bfa3c15003a377fbfe2338df7c0c91213a3b7e1f000b13aef81a47e0a5fcbb9226ba1fb9479d868ec807df4b157a7f9a55a50b4161e0983ace2552618828ad667ae2cac87b89cb7799611b9c8a4a3d1db83548554249914068bc8f8e27bb0f04efcdbf42e8d114e8ad2ec8b19dd6286c7d797bf1410b9ac7325ed3c2ddf275d261e0613df6f94d7bc9d52c442ec624687dd4751ea23117fe266123240fa0c1dbbe0f10363a23aa022db7e243e5ad07355037b05dd0cbf683cb0843d83602671a5596b18c586037e51cf71c5c591f18d1d70477c842ebdac4a2900d748f4c2caa934469b290f73c12630bcce8560608bcfcabe77662fc4930b39fa012ec4ea7bf5d664ca10926276406cb6c07da5964700b47ee8da109138d44716e2e95955398f7631250fd2f98a1ae8d00c0e8393e98e4ec79b27147a89df2cf2cdf465894bb5a3523193c05f253652fdaf3dabfbcad5f5454de814ee3f5cd7fdb704ad9155fb42faf91a8948beb4a3c5eeca55fc3618ab7fe14f0f51ddabb45271f29e851dd8dc72cc0c94156424c6d76ad513ed6e5dd34777511211139fef9b1ea614ce39d021d750bef7dac22d1d6b0754f1f75ca52b8a6337187d140566b7c148cc7fb2069f0a8d3f242dc2fa67c768c3472e952e8ef3b57806cb3df6e231d1d3a08179d98fe66c499fc57c2dadd4a793013cabed113936931be0d013d9e849ca312eff52b0fef9eb7af5baae2c9485e6d7ca10a66ee6c4bc20c8b437c8010f6e36c5578538014818e7f3d5e7bbb97285caa0e984fc11ca86039cb9601c35150c5089504c257ab2484c8a8acfe38413dc8d54e39556acf4861f8835c9a0b9ec3cd2a4ce528e6b6deeb12f83f2228d6389c51ec339d50f4b491a795366e41f85a96c1ad235dddf696ef76d2931c62ea328635e82710eccd6e030009094afb655930f5ab66dfdd3508bc420a87680053b4c89259ceda054166513bb4606024834918b2cfe95766cc1011cb0b3996f48fb10c52681ddf48608e9191ce73a95829fa043ebbe9fdf15f65569f7f089cb8f9b79544f4a70937018fc1b316e3fbf2d552cb3c86f82f986f47a5f82428172d62bc9060271341587c80b0f3715d5daa1557c6a191867f81ad777687dbc04203867525159b57779e5bb4411c9182a5fd229380d1be39284f2d2b52dc810b11e48b15b779ff2c95526478211c9182a5fd229380d1be39284f2d2b52dc810b11e48b15b779ff2c9552647820606274872e904514fae54c392fe05eebacb317cf21864c2145ef527e8fd9732000000000000000000000000000000000000000000000000000000000000000012a96346dc56bb373fa7a47481f2a555af7e698d7d5ee85e15b52a71eca6b52600000000000000000000000000000000000000000000000000000000000000000bfa5869e48bffb049af571b016c1d02f704867d529dc476b4a8bbbc9ba20cc700000000000000000000000000000000000000000000000000000000000000000c24b61b51e788fd16e52b7b36fa8900069d3ba1a8e0e33e0596f58c00adf8ea0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000025d1658b140c13094d36e2043cffa1ecb01445407f41e08940c939e939f1df221ceb995dc741d45436421b83f487762998685ae973395e1def8695bc3a7c48ac2f58ab52bbf23d07c1cf1d3b909349863231b8c18f4f1a792b641a2201c4e3cf1bb2e7cfaa9fa5283abf35c359d354d2029d4602f854b6fe66e709f3388d7c5504f9306478f85bf10ff9e6a871fa4f51b8323f545f1f928958487d5604da95d210695f710363a2a59725a9722f1f103797d7246a80c678a331f631a47f1a72982a47c24ea8c234baa3b8c92e0f90a9dc5108b6eae3ba4a7d9adbb6a407ea4813258218cc390dd445f73f6f7a9b96736e822c17795ccb861d832411e3f82a25dc2c35757e458af546c0e40729b98c3944281c93e57aa62c956a52b0a6a16ac21716e3399f5a595d209b93e5c1162124ceac81a5a942ec6dec634f1e405e45163e294978424c55f3e4d5ee1ba358c696c9bb9b3f41c1946c9c5ff4c0abcc9737f2304a39194bed1832f1cc0dd16dcd22a4a2836210ea919c791ae94e54491aa71b1f5915894a0532f5b967dd6803305046132c1464d9e470bfa762d3936d1afa1f0a53212fa32a08f3a16eddafb21f28d3fa5c68de79f77a5ea9f799def83052e20ebc04c55bf570740e73c7c9ad206969805dc775cf7f3b96c99751584b42ae3c2d031c2cf234e97c7edf4f3f5157a667230ca90efb584ce2a8064e6a3332833e291778011ed24a0aa5f9e39385551ed11e2fbd0eabcd9e586fbdab257d3ed08314c2135bba6a4ec65f4fe10f1fc53491d6915f24d2055c50ea81443bc3fed5f305eb69043695a255579709151c3c3b30a4e54512fa86584ea67b1150eb78fda92c3bb6c632d1da59421a4c7b311a4a26772453f1ec28a665a42ce7e337388665211dac05d94326b6dc0584a56406d982b227239e658d46ace8e76d2cb0fd1f062c1e2c120013147ebac78abea1da376cd631770b64f408756ef2405b9085c97612b21293158d932736155f6571406a67ec40d37f1df1d6453a47a8ddc95cda142a5dab6e640d4f51a1c4cb6e611219e39c4634cf9f2f9fe4f489bc343bdcfc930d78692d9b0cf97a807ef94d215c9d567c777da38447659632fcf77fbbcb4c0e259d0627925082f0c358fc9ed4d87ea06ba4cfae2b0bfdc1b7826cabc10bb52e20f62739e2aaaecec94c2e6fe064f9ff0b83bfb3e5961250dd776409d516edae0059d67bafe367e3070fe0002b5a481071e6b7461fe00b8b7d0964221c484df90ed20e230a92a5f8ea3d133c6407b2ffa849454190273285ff38710c2523bb3e2ec7bbdd8c9e54275e5a7c9430c331e5d57a29d0a1fa02f3793217aa8ddb83170ab47acace7677455e8f72bd15248a16e26502d8c0da6ad7180bb8de7f66c5b02eeeb1097a82e1d589a98c740ddfac10b6423b9acf895ab81694d52f62915e462f135791804a8f1f4a305a044d62bd8429c74fa722e18b60353fdb06934a611e254c61d9caab50a63ba42107f19b2dbd903037b9deacd4945977e20ac1eef403149f7e597115482c1d37dd83af3f9feb33a2d86823363939a0aca5692d1609060b27b448e1ef414237cd8aba666d788b5cdb8ad8fb3ecc6f578aaa56838a83290de347ba95ab6dc2109e5897a330d135a458a79a73dd1474a17cb8931b4a72b608c22aaf9feb20877a2c9274eb13d96912be4d9b5743ea1cdb7ded77480a116c2f1dd0809bb923f32fab5b669653ca536dbd7a6053ba6fbb362d28a149adc424";

        bytes memory proof = vm.ffi(input_proof);
        // bytes memory proof = abi.decode(res_proof, (bytes));

        string[] memory input_instance_0 = new string[](3);
        input_instance_0[0] = "echo";
        input_instance_0[1] = "-n";
        input_instance_0[2] = "0x1d4fe12616b87b7b24900ea142a0147c94d7d19dd4617e37c84316b40faf2b44";

        bytes memory res_instance_0 = vm.ffi(input_instance_0);
        uint256 instance_0 = abi.decode(res_instance_0, (uint256));

        string[] memory input_instance_1 = new string[](3);
        input_instance_1[0] = "echo";
        input_instance_1[1] = "-n";
        input_instance_1[2] = "0x0000000000000000000000000000000000000000000000000000000000000023";

        bytes memory res_instance_1 = vm.ffi(input_instance_1);
        uint256 instance_1 = abi.decode(res_instance_1, (uint256));

        uint256[] memory instances = new uint256[](2);
        instances[0] = instance_0;
        instances[1] = instance_1;
        ci.mint(
            proof,
            instances
        );
    }

    function testFailMintUnrestricted() public {
        for (uint i=0; i < 1001; ++i) {
            ci.unrestrictedMint();
            assertEq(ci.balanceOf(address(this)), i+1);

            // output metadata into file
            string memory metadata_output = ci.tokenURI(i+1);
            vm.writeJson(metadata_output, string(abi.encodePacked("./test/metadata/", (i+1).toString())));
        }

    }

}
