// SPDX-License-Identifier: UNLICENSED
pragma solidity ^0.8.13;

import {Test, console2} from "forge-std/Test.sol";
import {CryptoIdol} from "../src/CryptoIdol.sol";
import {CryptoIdolArt} from "../src/CryptoIdolArt.sol";
import {CryptoIdolArtExtra} from "../src/CryptoIdolArtExtra.sol";
import {Halo2Verifier} from "../src/Halo2Verifier.sol";
import {LibString} from "lib/solady/src/utils/LibString.sol";

contract CryptoIdolHarness is CryptoIdol {
    constructor (address owner_, address verifier_, address cryptoIdolArt_)
        CryptoIdol(owner_, verifier_, cryptoIdolArt_)
    {
        maxTokenCount = 1_000;

    }
    function unrestrictedMint() external {
        ++tokenCount;

        if (tokenCount > maxTokenCount) {
            revert CryptoIdol.MINTED_OUT();
        }

        score[tokenCount] = 0;
        minter[tokenCount] = msg.sender;
        mintTime[tokenCount] = block.timestamp;
        _safeMint(msg.sender, tokenCount);
    }
}

abstract contract ERC721TokenReceiver {
    function onERC721Received(address, address, uint256, bytes calldata)
        external
        virtual
        returns (bytes4)
    {
        return ERC721TokenReceiver.onERC721Received.selector;
    }
}


contract CryptoIdolTest is Test, ERC721TokenReceiver {
    using LibString for uint256;

    CryptoIdolHarness public ci;
    Halo2Verifier public civ;
    CryptoIdolArt public cia;
    CryptoIdolArtExtra public ciae;

    function setUp() public {
        civ = new Halo2Verifier();
        ciae = new CryptoIdolArtExtra();
        cia = new CryptoIdolArt(address(ciae));
        ci = new CryptoIdolHarness(address(this), address(civ), address(cia));
    }

    receive() payable external {

    }

    function testSymbolAndName() public {
        assertEq(ci.name(), "CryptoIdol");
        assertEq(ci.symbol(), "IDOLNFT");
    }

    function testIfOwnerCanUpdateVerifier() public {
        Halo2Verifier newCiv = new Halo2Verifier();

        ci.updateVerifier(address(newCiv));

        assertEq(address(ci.verifier()), address(newCiv));

        ci.updateVerifier(address(civ));

        assertEq(address(ci.verifier()), address(civ));
    }

    function testFailIfNonOwnerCanUpdateVerifier() public {
        Halo2Verifier newCiv = new Halo2Verifier();
        vm.prank(address(1));
        ci.updateVerifier(address(newCiv));
    }

    function testRenounceOwnership() public {
        ci.renounceOwnership();
        assertEq(ci.owner(), address(0));
    }

    function testChangeOwnership() public {
        ci.transferOwnership(address(1));
        assertEq(ci.owner(), address(1));
    }

    function testMint() public {
        string[] memory input_proof = new string[](3);
        input_proof[0] = "echo";
        input_proof[1] = "-n";
        input_proof[2] = "0x13cdccf70182a905512ad360ee536387df86a4e7a40d2ec5e8e497ae20129aed011fd8671730d4f022ed6a3053874733cdfb7c262cfd389c4e4f57dade32e54724b9c8131ce25eb80b996080731f68b4d222ac7e14441b23afb4e7073aaec51b0e84268687366f43dd2bd347faf71df6a511503f93f2707fd73bf1baeb5dea3f2bb2a2e1d5e133a65dd8b90f56bf4a92eb0882f3719e3146887f242e1a14d1d52fc478696d2c76e766abfb268dd67afb59bff441d1a8cabae8033d6e24839db7071a8d0a04416be212929350b8c7144595a6e3b2be444b7c44b5db0c58db0a811b43443be77246a057eff3f4cd930170857d8f1fc5341eb1452008d7105c47f72d9e89cceead9545ba37f12b44ca23a9f678c028e600dbe73b7d763f53d5ff4b1549631a6e66a2ccf655add5ed0f8929c9f6ecc62e9d3787c3906b6fd37211da12774eec83221d02c8a7e7a142c9ad8380584e69fdceac1e8d833fd6a74490c7287d8c5715d8b07ee3879b9d155362770279c990e5893237d0fc36ddd2de71781db10ac0701af12a7fac3b68a4fad21e3ebddf766e3a45ad10c54828b8876def2a113973e9be0facf2e5284b3a2b60646150643e6505a78e90af1c6a6efce2be10923fc17f250f67ea7d803fbab9e04874f72097b6846c22a3c3f63e8991af6e29fc13f6d413264d51b687e311ca85a42d45c84aa11ae401a823f20ff9c6ec4101ec74b3afb236ac511afbbaa1f8a0ef0edef0fa2b595eaf96ad914ed703fe1a28493c75e319da1b491d880439111d5dcdb4ac6b97d8a3e09e9f76ee329537f5017bcf3fca3622fcf3fe6cfe00038ef301798858fcac329fd3fd57c8886d08fb20b0a8370e87a7f05e574594df833cc65945f97bfba0c2698c99df3c840841db1781d26e61a2411bc542d1643da22da34305d6830e84cb6c34bdda56e0e73da5085ad8d5029fb3b73781dc42df680ce67ac7791fbcea9f681d69c544bdf568e629e208460383dd7b0a5fd9f717fd63380132cb44c69388a7ebe66ee02eeea9ea2d7e9b55d64e8251bf4f576ecb85c129da8805a18904a3bc56f4ef1f046fbd111c313af6851e976b1401c8c545808ca118ffafa78b0e495470d67a5180ee96532e4a224338557a46e1d8ff000005237abe3a1e0b7fbdfee57d16938456a67c41246e87e2965cefc315ffa88f0f7a8b545bd4a3fb19fd574e51d529df099d421612b58e010494bc50abe4c46554b645064c59297c5228c79baeba0f5ad4c0070a0bbe6bcf8f00830a208c9a8bfa9b7c48b1e851c6509939157a31d228bbdd30080a622a952ba5a2885dfa3f7c9f5f0447e45958c7923f85f0f3b38bae7db448381d25762ac2f5a4e50187a29239585ca148683fa3b3f75614c29523ae4b59d5df130e9a5dd193aa40626dc0275eddeff0b6a5a4b4fcae324e62f232071a6ce8e219cf3ea20774e6b8d57796bb78cb572a65a74c30e3b075aedbbd547cc4f79a5c207a0c1b1825b84ab02428672999bd3b021662b4a7a6f6ee550b36d2bcdd3aff09636a2bd328b60d24479ee9a79c321a6539bb06f955388d637257e0d0152d56106a9a51ffa51364bea24d5df51fbf9f4e93b69338aeec75880824b058e542802c24ca5fe233665420399994e21440f5b57e7d8421aa017acfcce4bb3d9a614b126b62d1f399544cb1dbba0bf171d3826e1f4da5a268cef94930ec40b500a6ea22d485707b80440c7906d6eca2be588926cb03ec1a1001c32b7ebd8f03b223fd11aeb79c83c4627be70eb520646310e81dca59ad3ca249e0ae500191c410929c1136a5d58de3c881de3afc1e4d13e0fb1070070427816386d04b5df85eb5b5b60557b57e3ff1e350e68e5894f58cbf4da03e6fbd62679ca18c5aeeb6f4c029f0059f559dd13a82385d842ad428e43e00b17dfe03051f16a1ccba86582b63e600296ba5168159fbdf6883835a5d3064d2b6c3482303f119019d844a2c2c437a290351aa6909c2b3aa1373c0b19749694a2465413354cb8eea24249537985f534b0fd71cf3144811815a7854d2318c041608e1a9dfa90a9309591d3a2fc1f317f0167f14d0e77ff52d0175ce72c96632e1aa061457e7312bc8d8b65ad13ad632c42e54554e727007240f7b8573102031bcac7399b46ded43418c79bd860f48eba11070e5be23482eb3e51062928d9828037e1394e8b88e99290f228d75effcddb904c1bf21df7c56cd98733be6d35bb40908b486f28761375edc1adbdf63677537093c7dd6620212b468de817ee9e819220d27b5143d842ad989bce3bdbb0556180e0c870b0db7448c388284bccbec02f148167161167ec48921ca6992d130e6372ed570f60a18cdf45a44f822249a9d701432dff920e64f69c6cbfab683a0e6e301c450c0232975110bb64c0d023a34b79af0e82a271da0814ba46bf50fa9924a2057b6113f79c99480adaa2e0c179062440e9a4c4f51ea732eec3b1adb7f822e04f5f7bd273253edbc7fba0e2c753c62b9f63d5b9d58659f61d9bf2ca70bada605df781c5d35947dec8a0e1507a3751839a349a17538ff29bb65b7f952b3bbb12b806e541101adcf984e052615ea389cca35d2579250431b94d7b3f3b87fae9406ebce8f37fcabe181097ec5b629177d644859264b7092a24b0f5076358e0e2c009e01b5c30878b1993de6fa743781cc2ea5f70989fb8ea2363d79d6a3ccbe1a08d617950c9e811eadecf636b69d831541178c6c2b6ba24aa39b1364654e8e3c29b5c59b39558de616da5228f272b1f3a7943e12913359e7079dcb4df45cab242f2207c7d72a469bddd2f6d9501c2972e3941897c74e5df9891a0f381eca6454103321947b77d865eaa458508d29e19916ddfa32d7faf22853a731fa753478e208d978c8591f86e1d4138b88cca517bc5812d2512437a8b647a24293592f13502bae0ba4bd62e1766f814bb010214bbe1d0f44201263c147d188827a48b078c62be72a06bdca4e2cc32135c80b7b4e2cd56680c95ad654e46c9edafd82d59f910220d0cee79281661ea8215368d0b85d5765a4e02a777a072c7f1af1f6de8c6d2eb62cd79c663064e7e0ffa44fc5d00f6ece5e9bea0ce0a30538e313d182e7f71692359e0acab919e3d4b7ee2c7749daaa8a7b0ebaf95c3605aa46400198a5c229850be2f05e54d8551e390c1edf6ba09bdefa8da7abe088c3c903d247bd22e30cd9c8c26b077c691a0c430db2a87b80c5acb19bf5ed668ffd97b88fda69fc7a2ff85c4ac4bc83d97c6c4a13a98b02cd811af78ef42d6909733dc03c650e0f941f1cda85f08b7a5b203655dd375a9f14f107d4f76b39925e782bc03f9ca90d5b000000000000000000000000000000000000000000000000000000000000000019bfa2ae8ab823154e7c8b003cbc60e9264f916664b8f96b85a46f0f0d40e2291ba449c898e9198e2f6c9ca0ac8ea16ad399e3efaffc612e7252080cfdd3a0621caef1abc4a830f9fdfeae6bc356b6d3cb8ad0712c9798acea1feb627c0bad2a23b99ad8822cad8931796ccbd31981566b9c89981b078bd14532d9e34de3f375303789e8c55244ac6b93e221995aee3cfe720004d66f9c53f91ce2a95230d54b2d950abcdda71224eba198b76796cbe4dac1795415d0955a85888202c2e7a6da1bf227caeaf3abbde37bc2ca93849ff621e07cbdf116c0c49e90291c952b81e41aaa67ba7b6f2229ecaf681ad08fae879ddcdafd48bdf56102bb221b0f918d4622b0c3eb7256dd457d90809c673ffdaa25277e28228911f8021434905d0562c70caaa543c876e08999aaba2ec81b17b047adc4df67615a29268bfa099c314d50000000000000000000000000000000000000000000000000000000000000000022f0e76260dfdd43a4902999ee21882b2e2b22b6e8e0201db3ec23843eddfbfb28d849cfbbb9aaaa9535d5bef1d8cc8c43367eee7982aeb80cce82397256c6c0238acc3d79849166d2e6a0a4fe1df10245bf4afce31c160455654769bb88a94e0ff56998825e0d3dcb50b0cd7369a7e2795f53969f689b3d50968cdd8ccd082d1e593d2d0493f4606ff05b2607003cecbd593c47daa11a2a89c6030d24d4272b00acc4c3003f197ba08289e02ac5723f562c4e58facca7a24303479e68b834e9172cdb0810ffc51dc1c59c19067caad5771fed0d7bac0a51bd52f09454f02f1b04d8a52be69fa7ac799ded2885d57e7ed59ceffc34924a8c5a69f05f3bfde9fa0d97d5e8345a5adf3cfdf4b62445ec5d1a898ddf3acd50647708690dd584f36a2871b6ec4f1c15b931a9458959a8173a98a65e712832538a6ffa8624fead973d00c240b905a7c29c958194a92d10e0e42ce1ac27785b0ef9a1e09b39a20986a7018e4dd9ccf8d2c9bf82c0937d98444d55c1a0759da8f836816fa16d06fbb28b05b2142b8ef0f9c5a1a1a5df4577dc5ee6d21d891dbdc0b598df2cd9e169b7e51476857e166efb8424f0e4e72602cb0241eb1541858e008a141c7c6a17afc57a00a1c8b93ac0c11ff488bf0333e2cf85ab58ad9c75e86bd553d317bb1e803b3c25f8e070802ab7348ddbb4ffeba5f28c936dde50ad939bdc2e9a0398486407880bd7bd451f5e59b11d3d91c463640d10cd51733b4661f10c5feeb02f163a6e552f03d7269d898207aa0de61ef01f2439d4909752887f637a02164fa228cd663204e47ab1ebc4772af14f169519dc8423e6115e9a7fd6c84f9ed54c05a59749b609b86a3e4010440bb525ef8a9ddba4f6b50fb0429630f449b2edc68d768fcbfe1eb0787f644e423fd4114186ceb9fec1fa6f12b4694b104f767dafd3fb02ab930840032cb0fa24e1ee1400543bf90d997efebfbd9c01dac69625370347b5e4a028891e8b0a308f1bb46d6705973786dd5e03de326e7933408f7aeea10dd512352dcacfd848dc6ba5122106068566429e526a3bb075555307ef60296506532cb20416fb6095b0bf450bf522357911ca3849bdb9b73c03f0df29f5c455e351061911f7717acfac480af39dde332d02ae8e67e7fda8697849e69e87109b53c681461f1c4c27a941231edfa1ea1d4282b14f63ec35b715b04adf8ade383fcdac1ef71b1e92b64e87ac2fec636d38cef26974e615d2d732691535f3fc02a55711733312e013bb1522c98a1847ff74ae6137db41a4d79f9b1ce758a4eba3b74ed4901f2508a6ee6073efeef8683fb52f53727b47aa08c6e654d124cbce813851908477041c8c940c9117352829a68881d83228f17f4acff6186e3082c2ce79c5f0837c25fc57cc51947b597381480f306597aab44cad682425453cfe1e1a69c281da511fdb74372110a76a8c6ce00bec1151798044e031bc7e7fc2dd3c06f8e98be8f30782f51d0a4a904caf46ccda7be974a5db4f61a6d1182337cb8738e51fe74c3d008b4af489fbc14ea28bc8c9cdb99d35b68944d083227e42502cd1540cee53810ac21e07637b7045ef14a22638a6b3023f28e3a345566e5aa2a65d23a65e4bdb01c39cb5bed6fe4a8810668209d21c8817ceea73f5ba4f11ab92b53212a4eacd012dd4fc5320e15757ece0d04ced7120d25ffaede18895463de8c59cc79ee82304ff37bc8c62d4ef6db9eb2274fd6a8566e4e7897464d1092dc41f0f335910d4224688e24da38fc128d1e7888db5acb887c365e0907448389f667e9940d059ab0cd172c88a54fdc435094f71e081dfedd8b8668c077f933711e27130dd14ef5521ff5fbe64191d196721f96f245079158a6b1f3903aa1039304870b6a5bffa552585a65fa23dc824d709e0f70b11751d33b95d3830735f9a03de915c7e2d387a03ea9b298f64e8cd47d588814eb9faa98019558c89a1694d370909c48e1db6462d8e0bb396e8a3360bdfc9a19cbc022708830311201507e12d77c12240be69d3";

        bytes memory proof = vm.ffi(input_proof);

        string[] memory input_instance_0 = new string[](3);
        input_instance_0[0] = "echo";
        input_instance_0[1] = "-n";
        input_instance_0[2] = "0x00000000000000000000000000000000000000000000000000000000000002d2";


        bytes memory res_instance_0 = vm.ffi(input_instance_0);
        uint256 instance_0 = abi.decode(res_instance_0, (uint256));

        string[] memory input_instance_1 = new string[](3);
        input_instance_1[0] = "echo";
        input_instance_1[1] = "-n";
        input_instance_1[2] = "0x0000000000000000000000000000000000000000000000000000000000000e5d";

        bytes memory res_instance_1 = vm.ffi(input_instance_1);
        uint256 instance_1 = abi.decode(res_instance_1, (uint256));


        uint256[] memory instances = new uint256[](2);
        instances[0] = instance_0;
        instances[1] = instance_1;

        bytes32 resultHash = keccak256(abi.encode(proof, instances));

        // commit result
        ci.commitResult(resultHash);
        (address committer, uint64 commitTime, uint64 revealTime) = ci.commits(resultHash);

        assertEq(committer, address(this));
        assertEq(commitTime, block.timestamp);
        assertEq(revealTime, 0);


        // mint and balance check
        uint256 myBalance = address(this).balance;
        ci.mint{value: 0.01 ether}(proof, instances);
        assertTrue(address(this).balance <= myBalance - 0.01 ether);
        assertEq(address(ci).balance, 0.01 ether);
        assertEq(ci.balanceOf(address(this)), 1);
        ci.withdraw();
        assertEq(address(ci).balance, 0);
        assertTrue(address(this).balance >= myBalance);

        // Check the score
        assertEq(ci.score(1), 4);

        // output metadata into file
        string memory metadata_output = ci.tokenURI(1);
        vm.writeJson(metadata_output, "./test/metadata/1");
    }

    function testFailMintNoncommitter() public {
        string[] memory input_proof = new string[](3);
        input_proof[0] = "echo";
        input_proof[1] = "-n";
        input_proof[2] = "0x13cdccf70182a905512ad360ee536387df86a4e7a40d2ec5e8e497ae20129aed011fd8671730d4f022ed6a3053874733cdfb7c262cfd389c4e4f57dade32e54724b9c8131ce25eb80b996080731f68b4d222ac7e14441b23afb4e7073aaec51b0e84268687366f43dd2bd347faf71df6a511503f93f2707fd73bf1baeb5dea3f2bb2a2e1d5e133a65dd8b90f56bf4a92eb0882f3719e3146887f242e1a14d1d52fc478696d2c76e766abfb268dd67afb59bff441d1a8cabae8033d6e24839db7071a8d0a04416be212929350b8c7144595a6e3b2be444b7c44b5db0c58db0a811b43443be77246a057eff3f4cd930170857d8f1fc5341eb1452008d7105c47f72d9e89cceead9545ba37f12b44ca23a9f678c028e600dbe73b7d763f53d5ff4b1549631a6e66a2ccf655add5ed0f8929c9f6ecc62e9d3787c3906b6fd37211da12774eec83221d02c8a7e7a142c9ad8380584e69fdceac1e8d833fd6a74490c7287d8c5715d8b07ee3879b9d155362770279c990e5893237d0fc36ddd2de71781db10ac0701af12a7fac3b68a4fad21e3ebddf766e3a45ad10c54828b8876def2a113973e9be0facf2e5284b3a2b60646150643e6505a78e90af1c6a6efce2be10923fc17f250f67ea7d803fbab9e04874f72097b6846c22a3c3f63e8991af6e29fc13f6d413264d51b687e311ca85a42d45c84aa11ae401a823f20ff9c6ec4101ec74b3afb236ac511afbbaa1f8a0ef0edef0fa2b595eaf96ad914ed703fe1a28493c75e319da1b491d880439111d5dcdb4ac6b97d8a3e09e9f76ee329537f5017bcf3fca3622fcf3fe6cfe00038ef301798858fcac329fd3fd57c8886d08fb20b0a8370e87a7f05e574594df833cc65945f97bfba0c2698c99df3c840841db1781d26e61a2411bc542d1643da22da34305d6830e84cb6c34bdda56e0e73da5085ad8d5029fb3b73781dc42df680ce67ac7791fbcea9f681d69c544bdf568e629e208460383dd7b0a5fd9f717fd63380132cb44c69388a7ebe66ee02eeea9ea2d7e9b55d64e8251bf4f576ecb85c129da8805a18904a3bc56f4ef1f046fbd111c313af6851e976b1401c8c545808ca118ffafa78b0e495470d67a5180ee96532e4a224338557a46e1d8ff000005237abe3a1e0b7fbdfee57d16938456a67c41246e87e2965cefc315ffa88f0f7a8b545bd4a3fb19fd574e51d529df099d421612b58e010494bc50abe4c46554b645064c59297c5228c79baeba0f5ad4c0070a0bbe6bcf8f00830a208c9a8bfa9b7c48b1e851c6509939157a31d228bbdd30080a622a952ba5a2885dfa3f7c9f5f0447e45958c7923f85f0f3b38bae7db448381d25762ac2f5a4e50187a29239585ca148683fa3b3f75614c29523ae4b59d5df130e9a5dd193aa40626dc0275eddeff0b6a5a4b4fcae324e62f232071a6ce8e219cf3ea20774e6b8d57796bb78cb572a65a74c30e3b075aedbbd547cc4f79a5c207a0c1b1825b84ab02428672999bd3b021662b4a7a6f6ee550b36d2bcdd3aff09636a2bd328b60d24479ee9a79c321a6539bb06f955388d637257e0d0152d56106a9a51ffa51364bea24d5df51fbf9f4e93b69338aeec75880824b058e542802c24ca5fe233665420399994e21440f5b57e7d8421aa017acfcce4bb3d9a614b126b62d1f399544cb1dbba0bf171d3826e1f4da5a268cef94930ec40b500a6ea22d485707b80440c7906d6eca2be588926cb03ec1a1001c32b7ebd8f03b223fd11aeb79c83c4627be70eb520646310e81dca59ad3ca249e0ae500191c410929c1136a5d58de3c881de3afc1e4d13e0fb1070070427816386d04b5df85eb5b5b60557b57e3ff1e350e68e5894f58cbf4da03e6fbd62679ca18c5aeeb6f4c029f0059f559dd13a82385d842ad428e43e00b17dfe03051f16a1ccba86582b63e600296ba5168159fbdf6883835a5d3064d2b6c3482303f119019d844a2c2c437a290351aa6909c2b3aa1373c0b19749694a2465413354cb8eea24249537985f534b0fd71cf3144811815a7854d2318c041608e1a9dfa90a9309591d3a2fc1f317f0167f14d0e77ff52d0175ce72c96632e1aa061457e7312bc8d8b65ad13ad632c42e54554e727007240f7b8573102031bcac7399b46ded43418c79bd860f48eba11070e5be23482eb3e51062928d9828037e1394e8b88e99290f228d75effcddb904c1bf21df7c56cd98733be6d35bb40908b486f28761375edc1adbdf63677537093c7dd6620212b468de817ee9e819220d27b5143d842ad989bce3bdbb0556180e0c870b0db7448c388284bccbec02f148167161167ec48921ca6992d130e6372ed570f60a18cdf45a44f822249a9d701432dff920e64f69c6cbfab683a0e6e301c450c0232975110bb64c0d023a34b79af0e82a271da0814ba46bf50fa9924a2057b6113f79c99480adaa2e0c179062440e9a4c4f51ea732eec3b1adb7f822e04f5f7bd273253edbc7fba0e2c753c62b9f63d5b9d58659f61d9bf2ca70bada605df781c5d35947dec8a0e1507a3751839a349a17538ff29bb65b7f952b3bbb12b806e541101adcf984e052615ea389cca35d2579250431b94d7b3f3b87fae9406ebce8f37fcabe181097ec5b629177d644859264b7092a24b0f5076358e0e2c009e01b5c30878b1993de6fa743781cc2ea5f70989fb8ea2363d79d6a3ccbe1a08d617950c9e811eadecf636b69d831541178c6c2b6ba24aa39b1364654e8e3c29b5c59b39558de616da5228f272b1f3a7943e12913359e7079dcb4df45cab242f2207c7d72a469bddd2f6d9501c2972e3941897c74e5df9891a0f381eca6454103321947b77d865eaa458508d29e19916ddfa32d7faf22853a731fa753478e208d978c8591f86e1d4138b88cca517bc5812d2512437a8b647a24293592f13502bae0ba4bd62e1766f814bb010214bbe1d0f44201263c147d188827a48b078c62be72a06bdca4e2cc32135c80b7b4e2cd56680c95ad654e46c9edafd82d59f910220d0cee79281661ea8215368d0b85d5765a4e02a777a072c7f1af1f6de8c6d2eb62cd79c663064e7e0ffa44fc5d00f6ece5e9bea0ce0a30538e313d182e7f71692359e0acab919e3d4b7ee2c7749daaa8a7b0ebaf95c3605aa46400198a5c229850be2f05e54d8551e390c1edf6ba09bdefa8da7abe088c3c903d247bd22e30cd9c8c26b077c691a0c430db2a87b80c5acb19bf5ed668ffd97b88fda69fc7a2ff85c4ac4bc83d97c6c4a13a98b02cd811af78ef42d6909733dc03c650e0f941f1cda85f08b7a5b203655dd375a9f14f107d4f76b39925e782bc03f9ca90d5b000000000000000000000000000000000000000000000000000000000000000019bfa2ae8ab823154e7c8b003cbc60e9264f916664b8f96b85a46f0f0d40e2291ba449c898e9198e2f6c9ca0ac8ea16ad399e3efaffc612e7252080cfdd3a0621caef1abc4a830f9fdfeae6bc356b6d3cb8ad0712c9798acea1feb627c0bad2a23b99ad8822cad8931796ccbd31981566b9c89981b078bd14532d9e34de3f375303789e8c55244ac6b93e221995aee3cfe720004d66f9c53f91ce2a95230d54b2d950abcdda71224eba198b76796cbe4dac1795415d0955a85888202c2e7a6da1bf227caeaf3abbde37bc2ca93849ff621e07cbdf116c0c49e90291c952b81e41aaa67ba7b6f2229ecaf681ad08fae879ddcdafd48bdf56102bb221b0f918d4622b0c3eb7256dd457d90809c673ffdaa25277e28228911f8021434905d0562c70caaa543c876e08999aaba2ec81b17b047adc4df67615a29268bfa099c314d50000000000000000000000000000000000000000000000000000000000000000022f0e76260dfdd43a4902999ee21882b2e2b22b6e8e0201db3ec23843eddfbfb28d849cfbbb9aaaa9535d5bef1d8cc8c43367eee7982aeb80cce82397256c6c0238acc3d79849166d2e6a0a4fe1df10245bf4afce31c160455654769bb88a94e0ff56998825e0d3dcb50b0cd7369a7e2795f53969f689b3d50968cdd8ccd082d1e593d2d0493f4606ff05b2607003cecbd593c47daa11a2a89c6030d24d4272b00acc4c3003f197ba08289e02ac5723f562c4e58facca7a24303479e68b834e9172cdb0810ffc51dc1c59c19067caad5771fed0d7bac0a51bd52f09454f02f1b04d8a52be69fa7ac799ded2885d57e7ed59ceffc34924a8c5a69f05f3bfde9fa0d97d5e8345a5adf3cfdf4b62445ec5d1a898ddf3acd50647708690dd584f36a2871b6ec4f1c15b931a9458959a8173a98a65e712832538a6ffa8624fead973d00c240b905a7c29c958194a92d10e0e42ce1ac27785b0ef9a1e09b39a20986a7018e4dd9ccf8d2c9bf82c0937d98444d55c1a0759da8f836816fa16d06fbb28b05b2142b8ef0f9c5a1a1a5df4577dc5ee6d21d891dbdc0b598df2cd9e169b7e51476857e166efb8424f0e4e72602cb0241eb1541858e008a141c7c6a17afc57a00a1c8b93ac0c11ff488bf0333e2cf85ab58ad9c75e86bd553d317bb1e803b3c25f8e070802ab7348ddbb4ffeba5f28c936dde50ad939bdc2e9a0398486407880bd7bd451f5e59b11d3d91c463640d10cd51733b4661f10c5feeb02f163a6e552f03d7269d898207aa0de61ef01f2439d4909752887f637a02164fa228cd663204e47ab1ebc4772af14f169519dc8423e6115e9a7fd6c84f9ed54c05a59749b609b86a3e4010440bb525ef8a9ddba4f6b50fb0429630f449b2edc68d768fcbfe1eb0787f644e423fd4114186ceb9fec1fa6f12b4694b104f767dafd3fb02ab930840032cb0fa24e1ee1400543bf90d997efebfbd9c01dac69625370347b5e4a028891e8b0a308f1bb46d6705973786dd5e03de326e7933408f7aeea10dd512352dcacfd848dc6ba5122106068566429e526a3bb075555307ef60296506532cb20416fb6095b0bf450bf522357911ca3849bdb9b73c03f0df29f5c455e351061911f7717acfac480af39dde332d02ae8e67e7fda8697849e69e87109b53c681461f1c4c27a941231edfa1ea1d4282b14f63ec35b715b04adf8ade383fcdac1ef71b1e92b64e87ac2fec636d38cef26974e615d2d732691535f3fc02a55711733312e013bb1522c98a1847ff74ae6137db41a4d79f9b1ce758a4eba3b74ed4901f2508a6ee6073efeef8683fb52f53727b47aa08c6e654d124cbce813851908477041c8c940c9117352829a68881d83228f17f4acff6186e3082c2ce79c5f0837c25fc57cc51947b597381480f306597aab44cad682425453cfe1e1a69c281da511fdb74372110a76a8c6ce00bec1151798044e031bc7e7fc2dd3c06f8e98be8f30782f51d0a4a904caf46ccda7be974a5db4f61a6d1182337cb8738e51fe74c3d008b4af489fbc14ea28bc8c9cdb99d35b68944d083227e42502cd1540cee53810ac21e07637b7045ef14a22638a6b3023f28e3a345566e5aa2a65d23a65e4bdb01c39cb5bed6fe4a8810668209d21c8817ceea73f5ba4f11ab92b53212a4eacd012dd4fc5320e15757ece0d04ced7120d25ffaede18895463de8c59cc79ee82304ff37bc8c62d4ef6db9eb2274fd6a8566e4e7897464d1092dc41f0f335910d4224688e24da38fc128d1e7888db5acb887c365e0907448389f667e9940d059ab0cd172c88a54fdc435094f71e081dfedd8b8668c077f933711e27130dd14ef5521ff5fbe64191d196721f96f245079158a6b1f3903aa1039304870b6a5bffa552585a65fa23dc824d709e0f70b11751d33b95d3830735f9a03de915c7e2d387a03ea9b298f64e8cd47d588814eb9faa98019558c89a1694d370909c48e1db6462d8e0bb396e8a3360bdfc9a19cbc022708830311201507e12d77c12240be69d3";

        bytes memory proof = vm.ffi(input_proof);

        string[] memory input_instance_0 = new string[](3);
        input_instance_0[0] = "echo";
        input_instance_0[1] = "-n";
        input_instance_0[2] = "0x00000000000000000000000000000000000000000000000000000000000002d2";

        bytes memory res_instance_0 = vm.ffi(input_instance_0);
        uint256 instance_0 = abi.decode(res_instance_0, (uint256));

        string[] memory input_instance_1 = new string[](3);
        input_instance_1[0] = "echo";
        input_instance_1[1] = "-n";
        input_instance_1[2] = "0x0000000000000000000000000000000000000000000000000000000000000e5d";

        bytes memory res_instance_1 = vm.ffi(input_instance_1);
        uint256 instance_1 = abi.decode(res_instance_1, (uint256));


        uint256[] memory instances = new uint256[](2);
        instances[0] = instance_0;
        instances[1] = instance_1;

        bytes32 resultHash = keccak256(abi.encode(proof, instances));

        // commit result
        ci.commitResult(resultHash);
        (address committer, uint64 commitTime, uint64 revealTime) = ci.commits(resultHash);

        assertEq(committer, address(this));
        assertEq(commitTime, block.timestamp);
        assertEq(revealTime, 0);


        // mint and balance check
        vm.prank(address(1));
        ci.mint{value: 0.01 ether}(proof, instances);
    }


    function testFailAlreadyCommitResult() public {
        string[] memory input_proof = new string[](3);
        input_proof[0] = "echo";
        input_proof[1] = "-n";
        input_proof[2] = "0x13cdccf70182a905512ad360ee536387df86a4e7a40d2ec5e8e497ae20129aed011fd8671730d4f022ed6a3053874733cdfb7c262cfd389c4e4f57dade32e54724b9c8131ce25eb80b996080731f68b4d222ac7e14441b23afb4e7073aaec51b0e84268687366f43dd2bd347faf71df6a511503f93f2707fd73bf1baeb5dea3f2bb2a2e1d5e133a65dd8b90f56bf4a92eb0882f3719e3146887f242e1a14d1d52fc478696d2c76e766abfb268dd67afb59bff441d1a8cabae8033d6e24839db7071a8d0a04416be212929350b8c7144595a6e3b2be444b7c44b5db0c58db0a811b43443be77246a057eff3f4cd930170857d8f1fc5341eb1452008d7105c47f72d9e89cceead9545ba37f12b44ca23a9f678c028e600dbe73b7d763f53d5ff4b1549631a6e66a2ccf655add5ed0f8929c9f6ecc62e9d3787c3906b6fd37211da12774eec83221d02c8a7e7a142c9ad8380584e69fdceac1e8d833fd6a74490c7287d8c5715d8b07ee3879b9d155362770279c990e5893237d0fc36ddd2de71781db10ac0701af12a7fac3b68a4fad21e3ebddf766e3a45ad10c54828b8876def2a113973e9be0facf2e5284b3a2b60646150643e6505a78e90af1c6a6efce2be10923fc17f250f67ea7d803fbab9e04874f72097b6846c22a3c3f63e8991af6e29fc13f6d413264d51b687e311ca85a42d45c84aa11ae401a823f20ff9c6ec4101ec74b3afb236ac511afbbaa1f8a0ef0edef0fa2b595eaf96ad914ed703fe1a28493c75e319da1b491d880439111d5dcdb4ac6b97d8a3e09e9f76ee329537f5017bcf3fca3622fcf3fe6cfe00038ef301798858fcac329fd3fd57c8886d08fb20b0a8370e87a7f05e574594df833cc65945f97bfba0c2698c99df3c840841db1781d26e61a2411bc542d1643da22da34305d6830e84cb6c34bdda56e0e73da5085ad8d5029fb3b73781dc42df680ce67ac7791fbcea9f681d69c544bdf568e629e208460383dd7b0a5fd9f717fd63380132cb44c69388a7ebe66ee02eeea9ea2d7e9b55d64e8251bf4f576ecb85c129da8805a18904a3bc56f4ef1f046fbd111c313af6851e976b1401c8c545808ca118ffafa78b0e495470d67a5180ee96532e4a224338557a46e1d8ff000005237abe3a1e0b7fbdfee57d16938456a67c41246e87e2965cefc315ffa88f0f7a8b545bd4a3fb19fd574e51d529df099d421612b58e010494bc50abe4c46554b645064c59297c5228c79baeba0f5ad4c0070a0bbe6bcf8f00830a208c9a8bfa9b7c48b1e851c6509939157a31d228bbdd30080a622a952ba5a2885dfa3f7c9f5f0447e45958c7923f85f0f3b38bae7db448381d25762ac2f5a4e50187a29239585ca148683fa3b3f75614c29523ae4b59d5df130e9a5dd193aa40626dc0275eddeff0b6a5a4b4fcae324e62f232071a6ce8e219cf3ea20774e6b8d57796bb78cb572a65a74c30e3b075aedbbd547cc4f79a5c207a0c1b1825b84ab02428672999bd3b021662b4a7a6f6ee550b36d2bcdd3aff09636a2bd328b60d24479ee9a79c321a6539bb06f955388d637257e0d0152d56106a9a51ffa51364bea24d5df51fbf9f4e93b69338aeec75880824b058e542802c24ca5fe233665420399994e21440f5b57e7d8421aa017acfcce4bb3d9a614b126b62d1f399544cb1dbba0bf171d3826e1f4da5a268cef94930ec40b500a6ea22d485707b80440c7906d6eca2be588926cb03ec1a1001c32b7ebd8f03b223fd11aeb79c83c4627be70eb520646310e81dca59ad3ca249e0ae500191c410929c1136a5d58de3c881de3afc1e4d13e0fb1070070427816386d04b5df85eb5b5b60557b57e3ff1e350e68e5894f58cbf4da03e6fbd62679ca18c5aeeb6f4c029f0059f559dd13a82385d842ad428e43e00b17dfe03051f16a1ccba86582b63e600296ba5168159fbdf6883835a5d3064d2b6c3482303f119019d844a2c2c437a290351aa6909c2b3aa1373c0b19749694a2465413354cb8eea24249537985f534b0fd71cf3144811815a7854d2318c041608e1a9dfa90a9309591d3a2fc1f317f0167f14d0e77ff52d0175ce72c96632e1aa061457e7312bc8d8b65ad13ad632c42e54554e727007240f7b8573102031bcac7399b46ded43418c79bd860f48eba11070e5be23482eb3e51062928d9828037e1394e8b88e99290f228d75effcddb904c1bf21df7c56cd98733be6d35bb40908b486f28761375edc1adbdf63677537093c7dd6620212b468de817ee9e819220d27b5143d842ad989bce3bdbb0556180e0c870b0db7448c388284bccbec02f148167161167ec48921ca6992d130e6372ed570f60a18cdf45a44f822249a9d701432dff920e64f69c6cbfab683a0e6e301c450c0232975110bb64c0d023a34b79af0e82a271da0814ba46bf50fa9924a2057b6113f79c99480adaa2e0c179062440e9a4c4f51ea732eec3b1adb7f822e04f5f7bd273253edbc7fba0e2c753c62b9f63d5b9d58659f61d9bf2ca70bada605df781c5d35947dec8a0e1507a3751839a349a17538ff29bb65b7f952b3bbb12b806e541101adcf984e052615ea389cca35d2579250431b94d7b3f3b87fae9406ebce8f37fcabe181097ec5b629177d644859264b7092a24b0f5076358e0e2c009e01b5c30878b1993de6fa743781cc2ea5f70989fb8ea2363d79d6a3ccbe1a08d617950c9e811eadecf636b69d831541178c6c2b6ba24aa39b1364654e8e3c29b5c59b39558de616da5228f272b1f3a7943e12913359e7079dcb4df45cab242f2207c7d72a469bddd2f6d9501c2972e3941897c74e5df9891a0f381eca6454103321947b77d865eaa458508d29e19916ddfa32d7faf22853a731fa753478e208d978c8591f86e1d4138b88cca517bc5812d2512437a8b647a24293592f13502bae0ba4bd62e1766f814bb010214bbe1d0f44201263c147d188827a48b078c62be72a06bdca4e2cc32135c80b7b4e2cd56680c95ad654e46c9edafd82d59f910220d0cee79281661ea8215368d0b85d5765a4e02a777a072c7f1af1f6de8c6d2eb62cd79c663064e7e0ffa44fc5d00f6ece5e9bea0ce0a30538e313d182e7f71692359e0acab919e3d4b7ee2c7749daaa8a7b0ebaf95c3605aa46400198a5c229850be2f05e54d8551e390c1edf6ba09bdefa8da7abe088c3c903d247bd22e30cd9c8c26b077c691a0c430db2a87b80c5acb19bf5ed668ffd97b88fda69fc7a2ff85c4ac4bc83d97c6c4a13a98b02cd811af78ef42d6909733dc03c650e0f941f1cda85f08b7a5b203655dd375a9f14f107d4f76b39925e782bc03f9ca90d5b000000000000000000000000000000000000000000000000000000000000000019bfa2ae8ab823154e7c8b003cbc60e9264f916664b8f96b85a46f0f0d40e2291ba449c898e9198e2f6c9ca0ac8ea16ad399e3efaffc612e7252080cfdd3a0621caef1abc4a830f9fdfeae6bc356b6d3cb8ad0712c9798acea1feb627c0bad2a23b99ad8822cad8931796ccbd31981566b9c89981b078bd14532d9e34de3f375303789e8c55244ac6b93e221995aee3cfe720004d66f9c53f91ce2a95230d54b2d950abcdda71224eba198b76796cbe4dac1795415d0955a85888202c2e7a6da1bf227caeaf3abbde37bc2ca93849ff621e07cbdf116c0c49e90291c952b81e41aaa67ba7b6f2229ecaf681ad08fae879ddcdafd48bdf56102bb221b0f918d4622b0c3eb7256dd457d90809c673ffdaa25277e28228911f8021434905d0562c70caaa543c876e08999aaba2ec81b17b047adc4df67615a29268bfa099c314d50000000000000000000000000000000000000000000000000000000000000000022f0e76260dfdd43a4902999ee21882b2e2b22b6e8e0201db3ec23843eddfbfb28d849cfbbb9aaaa9535d5bef1d8cc8c43367eee7982aeb80cce82397256c6c0238acc3d79849166d2e6a0a4fe1df10245bf4afce31c160455654769bb88a94e0ff56998825e0d3dcb50b0cd7369a7e2795f53969f689b3d50968cdd8ccd082d1e593d2d0493f4606ff05b2607003cecbd593c47daa11a2a89c6030d24d4272b00acc4c3003f197ba08289e02ac5723f562c4e58facca7a24303479e68b834e9172cdb0810ffc51dc1c59c19067caad5771fed0d7bac0a51bd52f09454f02f1b04d8a52be69fa7ac799ded2885d57e7ed59ceffc34924a8c5a69f05f3bfde9fa0d97d5e8345a5adf3cfdf4b62445ec5d1a898ddf3acd50647708690dd584f36a2871b6ec4f1c15b931a9458959a8173a98a65e712832538a6ffa8624fead973d00c240b905a7c29c958194a92d10e0e42ce1ac27785b0ef9a1e09b39a20986a7018e4dd9ccf8d2c9bf82c0937d98444d55c1a0759da8f836816fa16d06fbb28b05b2142b8ef0f9c5a1a1a5df4577dc5ee6d21d891dbdc0b598df2cd9e169b7e51476857e166efb8424f0e4e72602cb0241eb1541858e008a141c7c6a17afc57a00a1c8b93ac0c11ff488bf0333e2cf85ab58ad9c75e86bd553d317bb1e803b3c25f8e070802ab7348ddbb4ffeba5f28c936dde50ad939bdc2e9a0398486407880bd7bd451f5e59b11d3d91c463640d10cd51733b4661f10c5feeb02f163a6e552f03d7269d898207aa0de61ef01f2439d4909752887f637a02164fa228cd663204e47ab1ebc4772af14f169519dc8423e6115e9a7fd6c84f9ed54c05a59749b609b86a3e4010440bb525ef8a9ddba4f6b50fb0429630f449b2edc68d768fcbfe1eb0787f644e423fd4114186ceb9fec1fa6f12b4694b104f767dafd3fb02ab930840032cb0fa24e1ee1400543bf90d997efebfbd9c01dac69625370347b5e4a028891e8b0a308f1bb46d6705973786dd5e03de326e7933408f7aeea10dd512352dcacfd848dc6ba5122106068566429e526a3bb075555307ef60296506532cb20416fb6095b0bf450bf522357911ca3849bdb9b73c03f0df29f5c455e351061911f7717acfac480af39dde332d02ae8e67e7fda8697849e69e87109b53c681461f1c4c27a941231edfa1ea1d4282b14f63ec35b715b04adf8ade383fcdac1ef71b1e92b64e87ac2fec636d38cef26974e615d2d732691535f3fc02a55711733312e013bb1522c98a1847ff74ae6137db41a4d79f9b1ce758a4eba3b74ed4901f2508a6ee6073efeef8683fb52f53727b47aa08c6e654d124cbce813851908477041c8c940c9117352829a68881d83228f17f4acff6186e3082c2ce79c5f0837c25fc57cc51947b597381480f306597aab44cad682425453cfe1e1a69c281da511fdb74372110a76a8c6ce00bec1151798044e031bc7e7fc2dd3c06f8e98be8f30782f51d0a4a904caf46ccda7be974a5db4f61a6d1182337cb8738e51fe74c3d008b4af489fbc14ea28bc8c9cdb99d35b68944d083227e42502cd1540cee53810ac21e07637b7045ef14a22638a6b3023f28e3a345566e5aa2a65d23a65e4bdb01c39cb5bed6fe4a8810668209d21c8817ceea73f5ba4f11ab92b53212a4eacd012dd4fc5320e15757ece0d04ced7120d25ffaede18895463de8c59cc79ee82304ff37bc8c62d4ef6db9eb2274fd6a8566e4e7897464d1092dc41f0f335910d4224688e24da38fc128d1e7888db5acb887c365e0907448389f667e9940d059ab0cd172c88a54fdc435094f71e081dfedd8b8668c077f933711e27130dd14ef5521ff5fbe64191d196721f96f245079158a6b1f3903aa1039304870b6a5bffa552585a65fa23dc824d709e0f70b11751d33b95d3830735f9a03de915c7e2d387a03ea9b298f64e8cd47d588814eb9faa98019558c89a1694d370909c48e1db6462d8e0bb396e8a3360bdfc9a19cbc022708830311201507e12d77c12240be69d3";

        bytes memory proof = vm.ffi(input_proof);

        string[] memory input_instance_0 = new string[](3);
        input_instance_0[0] = "echo";
        input_instance_0[1] = "-n";
        input_instance_0[2] = "0x00000000000000000000000000000000000000000000000000000000000002d2";

        bytes memory res_instance_0 = vm.ffi(input_instance_0);
        uint256 instance_0 = abi.decode(res_instance_0, (uint256));

        string[] memory input_instance_1 = new string[](3);
        input_instance_1[0] = "echo";
        input_instance_1[1] = "-n";
        input_instance_1[2] = "0x0000000000000000000000000000000000000000000000000000000000000e5d";

        bytes memory res_instance_1 = vm.ffi(input_instance_1);
        uint256 instance_1 = abi.decode(res_instance_1, (uint256));


        uint256[] memory instances = new uint256[](2);
        instances[0] = instance_0;
        instances[1] = instance_1;

        bytes32 resultHash = keccak256(abi.encode(proof, instances));

        // commit result
        ci.commitResult(resultHash);
        ci.commitResult(resultHash);
    }

    function testFailMintTwice() public {
        string[] memory input_proof = new string[](3);
        input_proof[0] = "echo";
        input_proof[1] = "-n";
        input_proof[2] = "0x13cdccf70182a905512ad360ee536387df86a4e7a40d2ec5e8e497ae20129aed011fd8671730d4f022ed6a3053874733cdfb7c262cfd389c4e4f57dade32e54724b9c8131ce25eb80b996080731f68b4d222ac7e14441b23afb4e7073aaec51b0e84268687366f43dd2bd347faf71df6a511503f93f2707fd73bf1baeb5dea3f2bb2a2e1d5e133a65dd8b90f56bf4a92eb0882f3719e3146887f242e1a14d1d52fc478696d2c76e766abfb268dd67afb59bff441d1a8cabae8033d6e24839db7071a8d0a04416be212929350b8c7144595a6e3b2be444b7c44b5db0c58db0a811b43443be77246a057eff3f4cd930170857d8f1fc5341eb1452008d7105c47f72d9e89cceead9545ba37f12b44ca23a9f678c028e600dbe73b7d763f53d5ff4b1549631a6e66a2ccf655add5ed0f8929c9f6ecc62e9d3787c3906b6fd37211da12774eec83221d02c8a7e7a142c9ad8380584e69fdceac1e8d833fd6a74490c7287d8c5715d8b07ee3879b9d155362770279c990e5893237d0fc36ddd2de71781db10ac0701af12a7fac3b68a4fad21e3ebddf766e3a45ad10c54828b8876def2a113973e9be0facf2e5284b3a2b60646150643e6505a78e90af1c6a6efce2be10923fc17f250f67ea7d803fbab9e04874f72097b6846c22a3c3f63e8991af6e29fc13f6d413264d51b687e311ca85a42d45c84aa11ae401a823f20ff9c6ec4101ec74b3afb236ac511afbbaa1f8a0ef0edef0fa2b595eaf96ad914ed703fe1a28493c75e319da1b491d880439111d5dcdb4ac6b97d8a3e09e9f76ee329537f5017bcf3fca3622fcf3fe6cfe00038ef301798858fcac329fd3fd57c8886d08fb20b0a8370e87a7f05e574594df833cc65945f97bfba0c2698c99df3c840841db1781d26e61a2411bc542d1643da22da34305d6830e84cb6c34bdda56e0e73da5085ad8d5029fb3b73781dc42df680ce67ac7791fbcea9f681d69c544bdf568e629e208460383dd7b0a5fd9f717fd63380132cb44c69388a7ebe66ee02eeea9ea2d7e9b55d64e8251bf4f576ecb85c129da8805a18904a3bc56f4ef1f046fbd111c313af6851e976b1401c8c545808ca118ffafa78b0e495470d67a5180ee96532e4a224338557a46e1d8ff000005237abe3a1e0b7fbdfee57d16938456a67c41246e87e2965cefc315ffa88f0f7a8b545bd4a3fb19fd574e51d529df099d421612b58e010494bc50abe4c46554b645064c59297c5228c79baeba0f5ad4c0070a0bbe6bcf8f00830a208c9a8bfa9b7c48b1e851c6509939157a31d228bbdd30080a622a952ba5a2885dfa3f7c9f5f0447e45958c7923f85f0f3b38bae7db448381d25762ac2f5a4e50187a29239585ca148683fa3b3f75614c29523ae4b59d5df130e9a5dd193aa40626dc0275eddeff0b6a5a4b4fcae324e62f232071a6ce8e219cf3ea20774e6b8d57796bb78cb572a65a74c30e3b075aedbbd547cc4f79a5c207a0c1b1825b84ab02428672999bd3b021662b4a7a6f6ee550b36d2bcdd3aff09636a2bd328b60d24479ee9a79c321a6539bb06f955388d637257e0d0152d56106a9a51ffa51364bea24d5df51fbf9f4e93b69338aeec75880824b058e542802c24ca5fe233665420399994e21440f5b57e7d8421aa017acfcce4bb3d9a614b126b62d1f399544cb1dbba0bf171d3826e1f4da5a268cef94930ec40b500a6ea22d485707b80440c7906d6eca2be588926cb03ec1a1001c32b7ebd8f03b223fd11aeb79c83c4627be70eb520646310e81dca59ad3ca249e0ae500191c410929c1136a5d58de3c881de3afc1e4d13e0fb1070070427816386d04b5df85eb5b5b60557b57e3ff1e350e68e5894f58cbf4da03e6fbd62679ca18c5aeeb6f4c029f0059f559dd13a82385d842ad428e43e00b17dfe03051f16a1ccba86582b63e600296ba5168159fbdf6883835a5d3064d2b6c3482303f119019d844a2c2c437a290351aa6909c2b3aa1373c0b19749694a2465413354cb8eea24249537985f534b0fd71cf3144811815a7854d2318c041608e1a9dfa90a9309591d3a2fc1f317f0167f14d0e77ff52d0175ce72c96632e1aa061457e7312bc8d8b65ad13ad632c42e54554e727007240f7b8573102031bcac7399b46ded43418c79bd860f48eba11070e5be23482eb3e51062928d9828037e1394e8b88e99290f228d75effcddb904c1bf21df7c56cd98733be6d35bb40908b486f28761375edc1adbdf63677537093c7dd6620212b468de817ee9e819220d27b5143d842ad989bce3bdbb0556180e0c870b0db7448c388284bccbec02f148167161167ec48921ca6992d130e6372ed570f60a18cdf45a44f822249a9d701432dff920e64f69c6cbfab683a0e6e301c450c0232975110bb64c0d023a34b79af0e82a271da0814ba46bf50fa9924a2057b6113f79c99480adaa2e0c179062440e9a4c4f51ea732eec3b1adb7f822e04f5f7bd273253edbc7fba0e2c753c62b9f63d5b9d58659f61d9bf2ca70bada605df781c5d35947dec8a0e1507a3751839a349a17538ff29bb65b7f952b3bbb12b806e541101adcf984e052615ea389cca35d2579250431b94d7b3f3b87fae9406ebce8f37fcabe181097ec5b629177d644859264b7092a24b0f5076358e0e2c009e01b5c30878b1993de6fa743781cc2ea5f70989fb8ea2363d79d6a3ccbe1a08d617950c9e811eadecf636b69d831541178c6c2b6ba24aa39b1364654e8e3c29b5c59b39558de616da5228f272b1f3a7943e12913359e7079dcb4df45cab242f2207c7d72a469bddd2f6d9501c2972e3941897c74e5df9891a0f381eca6454103321947b77d865eaa458508d29e19916ddfa32d7faf22853a731fa753478e208d978c8591f86e1d4138b88cca517bc5812d2512437a8b647a24293592f13502bae0ba4bd62e1766f814bb010214bbe1d0f44201263c147d188827a48b078c62be72a06bdca4e2cc32135c80b7b4e2cd56680c95ad654e46c9edafd82d59f910220d0cee79281661ea8215368d0b85d5765a4e02a777a072c7f1af1f6de8c6d2eb62cd79c663064e7e0ffa44fc5d00f6ece5e9bea0ce0a30538e313d182e7f71692359e0acab919e3d4b7ee2c7749daaa8a7b0ebaf95c3605aa46400198a5c229850be2f05e54d8551e390c1edf6ba09bdefa8da7abe088c3c903d247bd22e30cd9c8c26b077c691a0c430db2a87b80c5acb19bf5ed668ffd97b88fda69fc7a2ff85c4ac4bc83d97c6c4a13a98b02cd811af78ef42d6909733dc03c650e0f941f1cda85f08b7a5b203655dd375a9f14f107d4f76b39925e782bc03f9ca90d5b000000000000000000000000000000000000000000000000000000000000000019bfa2ae8ab823154e7c8b003cbc60e9264f916664b8f96b85a46f0f0d40e2291ba449c898e9198e2f6c9ca0ac8ea16ad399e3efaffc612e7252080cfdd3a0621caef1abc4a830f9fdfeae6bc356b6d3cb8ad0712c9798acea1feb627c0bad2a23b99ad8822cad8931796ccbd31981566b9c89981b078bd14532d9e34de3f375303789e8c55244ac6b93e221995aee3cfe720004d66f9c53f91ce2a95230d54b2d950abcdda71224eba198b76796cbe4dac1795415d0955a85888202c2e7a6da1bf227caeaf3abbde37bc2ca93849ff621e07cbdf116c0c49e90291c952b81e41aaa67ba7b6f2229ecaf681ad08fae879ddcdafd48bdf56102bb221b0f918d4622b0c3eb7256dd457d90809c673ffdaa25277e28228911f8021434905d0562c70caaa543c876e08999aaba2ec81b17b047adc4df67615a29268bfa099c314d50000000000000000000000000000000000000000000000000000000000000000022f0e76260dfdd43a4902999ee21882b2e2b22b6e8e0201db3ec23843eddfbfb28d849cfbbb9aaaa9535d5bef1d8cc8c43367eee7982aeb80cce82397256c6c0238acc3d79849166d2e6a0a4fe1df10245bf4afce31c160455654769bb88a94e0ff56998825e0d3dcb50b0cd7369a7e2795f53969f689b3d50968cdd8ccd082d1e593d2d0493f4606ff05b2607003cecbd593c47daa11a2a89c6030d24d4272b00acc4c3003f197ba08289e02ac5723f562c4e58facca7a24303479e68b834e9172cdb0810ffc51dc1c59c19067caad5771fed0d7bac0a51bd52f09454f02f1b04d8a52be69fa7ac799ded2885d57e7ed59ceffc34924a8c5a69f05f3bfde9fa0d97d5e8345a5adf3cfdf4b62445ec5d1a898ddf3acd50647708690dd584f36a2871b6ec4f1c15b931a9458959a8173a98a65e712832538a6ffa8624fead973d00c240b905a7c29c958194a92d10e0e42ce1ac27785b0ef9a1e09b39a20986a7018e4dd9ccf8d2c9bf82c0937d98444d55c1a0759da8f836816fa16d06fbb28b05b2142b8ef0f9c5a1a1a5df4577dc5ee6d21d891dbdc0b598df2cd9e169b7e51476857e166efb8424f0e4e72602cb0241eb1541858e008a141c7c6a17afc57a00a1c8b93ac0c11ff488bf0333e2cf85ab58ad9c75e86bd553d317bb1e803b3c25f8e070802ab7348ddbb4ffeba5f28c936dde50ad939bdc2e9a0398486407880bd7bd451f5e59b11d3d91c463640d10cd51733b4661f10c5feeb02f163a6e552f03d7269d898207aa0de61ef01f2439d4909752887f637a02164fa228cd663204e47ab1ebc4772af14f169519dc8423e6115e9a7fd6c84f9ed54c05a59749b609b86a3e4010440bb525ef8a9ddba4f6b50fb0429630f449b2edc68d768fcbfe1eb0787f644e423fd4114186ceb9fec1fa6f12b4694b104f767dafd3fb02ab930840032cb0fa24e1ee1400543bf90d997efebfbd9c01dac69625370347b5e4a028891e8b0a308f1bb46d6705973786dd5e03de326e7933408f7aeea10dd512352dcacfd848dc6ba5122106068566429e526a3bb075555307ef60296506532cb20416fb6095b0bf450bf522357911ca3849bdb9b73c03f0df29f5c455e351061911f7717acfac480af39dde332d02ae8e67e7fda8697849e69e87109b53c681461f1c4c27a941231edfa1ea1d4282b14f63ec35b715b04adf8ade383fcdac1ef71b1e92b64e87ac2fec636d38cef26974e615d2d732691535f3fc02a55711733312e013bb1522c98a1847ff74ae6137db41a4d79f9b1ce758a4eba3b74ed4901f2508a6ee6073efeef8683fb52f53727b47aa08c6e654d124cbce813851908477041c8c940c9117352829a68881d83228f17f4acff6186e3082c2ce79c5f0837c25fc57cc51947b597381480f306597aab44cad682425453cfe1e1a69c281da511fdb74372110a76a8c6ce00bec1151798044e031bc7e7fc2dd3c06f8e98be8f30782f51d0a4a904caf46ccda7be974a5db4f61a6d1182337cb8738e51fe74c3d008b4af489fbc14ea28bc8c9cdb99d35b68944d083227e42502cd1540cee53810ac21e07637b7045ef14a22638a6b3023f28e3a345566e5aa2a65d23a65e4bdb01c39cb5bed6fe4a8810668209d21c8817ceea73f5ba4f11ab92b53212a4eacd012dd4fc5320e15757ece0d04ced7120d25ffaede18895463de8c59cc79ee82304ff37bc8c62d4ef6db9eb2274fd6a8566e4e7897464d1092dc41f0f335910d4224688e24da38fc128d1e7888db5acb887c365e0907448389f667e9940d059ab0cd172c88a54fdc435094f71e081dfedd8b8668c077f933711e27130dd14ef5521ff5fbe64191d196721f96f245079158a6b1f3903aa1039304870b6a5bffa552585a65fa23dc824d709e0f70b11751d33b95d3830735f9a03de915c7e2d387a03ea9b298f64e8cd47d588814eb9faa98019558c89a1694d370909c48e1db6462d8e0bb396e8a3360bdfc9a19cbc022708830311201507e12d77c12240be69d3";

        bytes memory proof = vm.ffi(input_proof);

        string[] memory input_instance_0 = new string[](3);
        input_instance_0[0] = "echo";
        input_instance_0[1] = "-n";
        input_instance_0[2] = "0x00000000000000000000000000000000000000000000000000000000000002d2";

        bytes memory res_instance_0 = vm.ffi(input_instance_0);
        uint256 instance_0 = abi.decode(res_instance_0, (uint256));

        string[] memory input_instance_1 = new string[](3);
        input_instance_1[0] = "echo";
        input_instance_1[1] = "-n";
        input_instance_1[2] = "0x0000000000000000000000000000000000000000000000000000000000000e5d";

        bytes memory res_instance_1 = vm.ffi(input_instance_1);
        uint256 instance_1 = abi.decode(res_instance_1, (uint256));


        uint256[] memory instances = new uint256[](2);
        instances[0] = instance_0;
        instances[1] = instance_1;

        bytes32 resultHash = keccak256(abi.encode(proof, instances));

        // commit result
        ci.commitResult(resultHash);
        (address committer, uint64 commitTime, uint64 revealTime) = ci.commits(resultHash);

        assertEq(committer, address(this));
        assertEq(commitTime, block.timestamp);
        assertEq(revealTime, 0);


        // mint and balance check
        ci.mint{value: 0.01 ether}(proof, instances);
        ci.mint{value: 0.01 ether}(proof, instances);
    }

    function testFailMintNoMoney() public {
        string[] memory input_proof = new string[](3);
        input_proof[0] = "echo";
        input_proof[1] = "-n";
        input_proof[2] = "0x13cdccf70182a905512ad360ee536387df86a4e7a40d2ec5e8e497ae20129aed011fd8671730d4f022ed6a3053874733cdfb7c262cfd389c4e4f57dade32e54724b9c8131ce25eb80b996080731f68b4d222ac7e14441b23afb4e7073aaec51b0e84268687366f43dd2bd347faf71df6a511503f93f2707fd73bf1baeb5dea3f2bb2a2e1d5e133a65dd8b90f56bf4a92eb0882f3719e3146887f242e1a14d1d52fc478696d2c76e766abfb268dd67afb59bff441d1a8cabae8033d6e24839db7071a8d0a04416be212929350b8c7144595a6e3b2be444b7c44b5db0c58db0a811b43443be77246a057eff3f4cd930170857d8f1fc5341eb1452008d7105c47f72d9e89cceead9545ba37f12b44ca23a9f678c028e600dbe73b7d763f53d5ff4b1549631a6e66a2ccf655add5ed0f8929c9f6ecc62e9d3787c3906b6fd37211da12774eec83221d02c8a7e7a142c9ad8380584e69fdceac1e8d833fd6a74490c7287d8c5715d8b07ee3879b9d155362770279c990e5893237d0fc36ddd2de71781db10ac0701af12a7fac3b68a4fad21e3ebddf766e3a45ad10c54828b8876def2a113973e9be0facf2e5284b3a2b60646150643e6505a78e90af1c6a6efce2be10923fc17f250f67ea7d803fbab9e04874f72097b6846c22a3c3f63e8991af6e29fc13f6d413264d51b687e311ca85a42d45c84aa11ae401a823f20ff9c6ec4101ec74b3afb236ac511afbbaa1f8a0ef0edef0fa2b595eaf96ad914ed703fe1a28493c75e319da1b491d880439111d5dcdb4ac6b97d8a3e09e9f76ee329537f5017bcf3fca3622fcf3fe6cfe00038ef301798858fcac329fd3fd57c8886d08fb20b0a8370e87a7f05e574594df833cc65945f97bfba0c2698c99df3c840841db1781d26e61a2411bc542d1643da22da34305d6830e84cb6c34bdda56e0e73da5085ad8d5029fb3b73781dc42df680ce67ac7791fbcea9f681d69c544bdf568e629e208460383dd7b0a5fd9f717fd63380132cb44c69388a7ebe66ee02eeea9ea2d7e9b55d64e8251bf4f576ecb85c129da8805a18904a3bc56f4ef1f046fbd111c313af6851e976b1401c8c545808ca118ffafa78b0e495470d67a5180ee96532e4a224338557a46e1d8ff000005237abe3a1e0b7fbdfee57d16938456a67c41246e87e2965cefc315ffa88f0f7a8b545bd4a3fb19fd574e51d529df099d421612b58e010494bc50abe4c46554b645064c59297c5228c79baeba0f5ad4c0070a0bbe6bcf8f00830a208c9a8bfa9b7c48b1e851c6509939157a31d228bbdd30080a622a952ba5a2885dfa3f7c9f5f0447e45958c7923f85f0f3b38bae7db448381d25762ac2f5a4e50187a29239585ca148683fa3b3f75614c29523ae4b59d5df130e9a5dd193aa40626dc0275eddeff0b6a5a4b4fcae324e62f232071a6ce8e219cf3ea20774e6b8d57796bb78cb572a65a74c30e3b075aedbbd547cc4f79a5c207a0c1b1825b84ab02428672999bd3b021662b4a7a6f6ee550b36d2bcdd3aff09636a2bd328b60d24479ee9a79c321a6539bb06f955388d637257e0d0152d56106a9a51ffa51364bea24d5df51fbf9f4e93b69338aeec75880824b058e542802c24ca5fe233665420399994e21440f5b57e7d8421aa017acfcce4bb3d9a614b126b62d1f399544cb1dbba0bf171d3826e1f4da5a268cef94930ec40b500a6ea22d485707b80440c7906d6eca2be588926cb03ec1a1001c32b7ebd8f03b223fd11aeb79c83c4627be70eb520646310e81dca59ad3ca249e0ae500191c410929c1136a5d58de3c881de3afc1e4d13e0fb1070070427816386d04b5df85eb5b5b60557b57e3ff1e350e68e5894f58cbf4da03e6fbd62679ca18c5aeeb6f4c029f0059f559dd13a82385d842ad428e43e00b17dfe03051f16a1ccba86582b63e600296ba5168159fbdf6883835a5d3064d2b6c3482303f119019d844a2c2c437a290351aa6909c2b3aa1373c0b19749694a2465413354cb8eea24249537985f534b0fd71cf3144811815a7854d2318c041608e1a9dfa90a9309591d3a2fc1f317f0167f14d0e77ff52d0175ce72c96632e1aa061457e7312bc8d8b65ad13ad632c42e54554e727007240f7b8573102031bcac7399b46ded43418c79bd860f48eba11070e5be23482eb3e51062928d9828037e1394e8b88e99290f228d75effcddb904c1bf21df7c56cd98733be6d35bb40908b486f28761375edc1adbdf63677537093c7dd6620212b468de817ee9e819220d27b5143d842ad989bce3bdbb0556180e0c870b0db7448c388284bccbec02f148167161167ec48921ca6992d130e6372ed570f60a18cdf45a44f822249a9d701432dff920e64f69c6cbfab683a0e6e301c450c0232975110bb64c0d023a34b79af0e82a271da0814ba46bf50fa9924a2057b6113f79c99480adaa2e0c179062440e9a4c4f51ea732eec3b1adb7f822e04f5f7bd273253edbc7fba0e2c753c62b9f63d5b9d58659f61d9bf2ca70bada605df781c5d35947dec8a0e1507a3751839a349a17538ff29bb65b7f952b3bbb12b806e541101adcf984e052615ea389cca35d2579250431b94d7b3f3b87fae9406ebce8f37fcabe181097ec5b629177d644859264b7092a24b0f5076358e0e2c009e01b5c30878b1993de6fa743781cc2ea5f70989fb8ea2363d79d6a3ccbe1a08d617950c9e811eadecf636b69d831541178c6c2b6ba24aa39b1364654e8e3c29b5c59b39558de616da5228f272b1f3a7943e12913359e7079dcb4df45cab242f2207c7d72a469bddd2f6d9501c2972e3941897c74e5df9891a0f381eca6454103321947b77d865eaa458508d29e19916ddfa32d7faf22853a731fa753478e208d978c8591f86e1d4138b88cca517bc5812d2512437a8b647a24293592f13502bae0ba4bd62e1766f814bb010214bbe1d0f44201263c147d188827a48b078c62be72a06bdca4e2cc32135c80b7b4e2cd56680c95ad654e46c9edafd82d59f910220d0cee79281661ea8215368d0b85d5765a4e02a777a072c7f1af1f6de8c6d2eb62cd79c663064e7e0ffa44fc5d00f6ece5e9bea0ce0a30538e313d182e7f71692359e0acab919e3d4b7ee2c7749daaa8a7b0ebaf95c3605aa46400198a5c229850be2f05e54d8551e390c1edf6ba09bdefa8da7abe088c3c903d247bd22e30cd9c8c26b077c691a0c430db2a87b80c5acb19bf5ed668ffd97b88fda69fc7a2ff85c4ac4bc83d97c6c4a13a98b02cd811af78ef42d6909733dc03c650e0f941f1cda85f08b7a5b203655dd375a9f14f107d4f76b39925e782bc03f9ca90d5b000000000000000000000000000000000000000000000000000000000000000019bfa2ae8ab823154e7c8b003cbc60e9264f916664b8f96b85a46f0f0d40e2291ba449c898e9198e2f6c9ca0ac8ea16ad399e3efaffc612e7252080cfdd3a0621caef1abc4a830f9fdfeae6bc356b6d3cb8ad0712c9798acea1feb627c0bad2a23b99ad8822cad8931796ccbd31981566b9c89981b078bd14532d9e34de3f375303789e8c55244ac6b93e221995aee3cfe720004d66f9c53f91ce2a95230d54b2d950abcdda71224eba198b76796cbe4dac1795415d0955a85888202c2e7a6da1bf227caeaf3abbde37bc2ca93849ff621e07cbdf116c0c49e90291c952b81e41aaa67ba7b6f2229ecaf681ad08fae879ddcdafd48bdf56102bb221b0f918d4622b0c3eb7256dd457d90809c673ffdaa25277e28228911f8021434905d0562c70caaa543c876e08999aaba2ec81b17b047adc4df67615a29268bfa099c314d50000000000000000000000000000000000000000000000000000000000000000022f0e76260dfdd43a4902999ee21882b2e2b22b6e8e0201db3ec23843eddfbfb28d849cfbbb9aaaa9535d5bef1d8cc8c43367eee7982aeb80cce82397256c6c0238acc3d79849166d2e6a0a4fe1df10245bf4afce31c160455654769bb88a94e0ff56998825e0d3dcb50b0cd7369a7e2795f53969f689b3d50968cdd8ccd082d1e593d2d0493f4606ff05b2607003cecbd593c47daa11a2a89c6030d24d4272b00acc4c3003f197ba08289e02ac5723f562c4e58facca7a24303479e68b834e9172cdb0810ffc51dc1c59c19067caad5771fed0d7bac0a51bd52f09454f02f1b04d8a52be69fa7ac799ded2885d57e7ed59ceffc34924a8c5a69f05f3bfde9fa0d97d5e8345a5adf3cfdf4b62445ec5d1a898ddf3acd50647708690dd584f36a2871b6ec4f1c15b931a9458959a8173a98a65e712832538a6ffa8624fead973d00c240b905a7c29c958194a92d10e0e42ce1ac27785b0ef9a1e09b39a20986a7018e4dd9ccf8d2c9bf82c0937d98444d55c1a0759da8f836816fa16d06fbb28b05b2142b8ef0f9c5a1a1a5df4577dc5ee6d21d891dbdc0b598df2cd9e169b7e51476857e166efb8424f0e4e72602cb0241eb1541858e008a141c7c6a17afc57a00a1c8b93ac0c11ff488bf0333e2cf85ab58ad9c75e86bd553d317bb1e803b3c25f8e070802ab7348ddbb4ffeba5f28c936dde50ad939bdc2e9a0398486407880bd7bd451f5e59b11d3d91c463640d10cd51733b4661f10c5feeb02f163a6e552f03d7269d898207aa0de61ef01f2439d4909752887f637a02164fa228cd663204e47ab1ebc4772af14f169519dc8423e6115e9a7fd6c84f9ed54c05a59749b609b86a3e4010440bb525ef8a9ddba4f6b50fb0429630f449b2edc68d768fcbfe1eb0787f644e423fd4114186ceb9fec1fa6f12b4694b104f767dafd3fb02ab930840032cb0fa24e1ee1400543bf90d997efebfbd9c01dac69625370347b5e4a028891e8b0a308f1bb46d6705973786dd5e03de326e7933408f7aeea10dd512352dcacfd848dc6ba5122106068566429e526a3bb075555307ef60296506532cb20416fb6095b0bf450bf522357911ca3849bdb9b73c03f0df29f5c455e351061911f7717acfac480af39dde332d02ae8e67e7fda8697849e69e87109b53c681461f1c4c27a941231edfa1ea1d4282b14f63ec35b715b04adf8ade383fcdac1ef71b1e92b64e87ac2fec636d38cef26974e615d2d732691535f3fc02a55711733312e013bb1522c98a1847ff74ae6137db41a4d79f9b1ce758a4eba3b74ed4901f2508a6ee6073efeef8683fb52f53727b47aa08c6e654d124cbce813851908477041c8c940c9117352829a68881d83228f17f4acff6186e3082c2ce79c5f0837c25fc57cc51947b597381480f306597aab44cad682425453cfe1e1a69c281da511fdb74372110a76a8c6ce00bec1151798044e031bc7e7fc2dd3c06f8e98be8f30782f51d0a4a904caf46ccda7be974a5db4f61a6d1182337cb8738e51fe74c3d008b4af489fbc14ea28bc8c9cdb99d35b68944d083227e42502cd1540cee53810ac21e07637b7045ef14a22638a6b3023f28e3a345566e5aa2a65d23a65e4bdb01c39cb5bed6fe4a8810668209d21c8817ceea73f5ba4f11ab92b53212a4eacd012dd4fc5320e15757ece0d04ced7120d25ffaede18895463de8c59cc79ee82304ff37bc8c62d4ef6db9eb2274fd6a8566e4e7897464d1092dc41f0f335910d4224688e24da38fc128d1e7888db5acb887c365e0907448389f667e9940d059ab0cd172c88a54fdc435094f71e081dfedd8b8668c077f933711e27130dd14ef5521ff5fbe64191d196721f96f245079158a6b1f3903aa1039304870b6a5bffa552585a65fa23dc824d709e0f70b11751d33b95d3830735f9a03de915c7e2d387a03ea9b298f64e8cd47d588814eb9faa98019558c89a1694d370909c48e1db6462d8e0bb396e8a3360bdfc9a19cbc022708830311201507e12d77c12240be69d3";

        bytes memory proof = vm.ffi(input_proof);
        // bytes memory proof = abi.decode(res_proof, (bytes));

        string[] memory input_instance_0 = new string[](3);
        input_instance_0[0] = "echo";
        input_instance_0[1] = "-n";
        input_instance_0[2] = "0x00000000000000000000000000000000000000000000000000000000000002d2";

        bytes memory res_instance_0 = vm.ffi(input_instance_0);
        uint256 instance_0 = abi.decode(res_instance_0, (uint256));

        string[] memory input_instance_1 = new string[](3);
        input_instance_1[0] = "echo";
        input_instance_1[1] = "-n";
        input_instance_1[2] = "0x0000000000000000000000000000000000000000000000000000000000000e5d";

        bytes memory res_instance_1 = vm.ffi(input_instance_1);
        uint256 instance_1 = abi.decode(res_instance_1, (uint256));

        uint256[] memory instances = new uint256[](2);
        instances[0] = instance_0;
        instances[1] = instance_1;
        ci.mint(
            proof,
            instances
        );
    }

    function testFailMintUnrestricted() public {
        for (uint i=0; i < 1001; ++i) {
            ci.unrestrictedMint();
            assertEq(ci.balanceOf(address(this)), i+1);

            // output metadata into file
            string memory metadata_output = ci.tokenURI(i+1);
            vm.writeJson(metadata_output, string(abi.encodePacked("./test/metadata/", (i+1).toString())));
        }

    }

}
